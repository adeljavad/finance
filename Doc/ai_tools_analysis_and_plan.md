# ุชุญูู ู ุจุฑูุงููโุฑุฒ ุณุณุชู ููุดููุฏ ุชุดุฎุต ุงุจุฒุงุฑูุง

## ๐ ุชุญูู ูุถุนุช ูุนู

### ุณุณุชู ููุฌูุฏ:
1. **ุงุจุฒุงุฑูุง ูุงู (Tools)**: ท ุงุจุฒุงุฑ ุงุตู ฺฉู ุฑู ุฏุงุฏูโูุง ูุงูุน ฺฉุงุฑ ูโฺฉููุฏ
   - ุชุญูู ูุณุจุชโูุง ูุงู
   - ุดูุงุณุง ุงูุญุฑุงูุงุช ูุงู  
   - ุชููุฏ ฺฏุฒุงุฑุด ูุงู
   - ุชุฑุงุฒ ฺฉู ฺูุงุฑุณุชูู
   - ุชุญูู ุนููฺฉุฑุฏ ูุตู
   - ฺฏุฒุงุฑุด ุฌุงูุน ูุงู
   - ุชุญูู ุฑุณฺฉโูุง ูุงู

2. **ุณุณุชู DeepSeek**: ุจุฑุง ูพุงุณุฎ ุจู ุณูุงูุงุช ุนููู ูุงู

3. **ูุดฺฉู ูุนู**: ุณุณุชู ููโุชูุงูุฏ ููุดููุฏุงูู ุชุดุฎุต ุฏูุฏ ฺู ุฒูุงู ุงุฒ ุงุจุฒุงุฑูุง ุงุณุชูุงุฏู ฺฉูุฏ ู ฺู ุฒูุงู ุงุฒ DeepSeek

## ๐ฏ ูุฏู ุงุตู

**ุงุฌุงุฏ ฺฉ ุณุณุชู ููุดููุฏ ฺฉู ุจุชูุงูุฏ ุชุดุฎุต ุฏูุฏ:**
- ุขุง ุณูุงู ูุฑุจูุท ุจู **ุฏุงุฏูโูุง ููุฌูุฏ** ุงุณุช โ ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑูุง
- ุขุง ุณูุงู ูุฑุจูุท ุจู **ุฏุงูุด ุนููู ูุงู** ุงุณุช โ ุงุณุชูุงุฏู ุงุฒ DeepSeek

## ๐ ุชุณฺฉโูุง ุงุตู

### ุชุณฺฉ ฑ: ุงุฌุงุฏ ุณุณุชู ุทุจููโุจูุฏ ููุดููุฏ
- [ ] ุทุฑุงุญ ูพุฑุงููพุช ููุดููุฏ ุจุฑุง ุชุดุฎุต ููุน ุณูุงู
- [ ] ุงุฌุงุฏ ุงูฺฏูุฑุชู ุชุดุฎุต ฺฉููุงุช ฺฉูุฏ ุงุจุฒุงุฑูุง
- [ ] ูพุงุฏูโุณุงุฒ ุณุณุชู ุงูุชุงุฒุฏู ุจุฑุง ุงุจุฒุงุฑูุง

### ุชุณฺฉ ฒ: ุชูุณุนู ุณุณุชู ุชุตููโฺฏุฑ
- [ ] ุงุฌุงุฏ ุชุงุจุน `_decide_tool_or_deepseek` 
- [ ] ุชุนู ุขุณุชุงููโูุง ุชุตููโฺฏุฑ
- [ ] ูพุงุฏูโุณุงุฒ ููุทู fallback

### ุชุณฺฉ ณ: ุจูุจูุฏ ูพุฑุงููพุชโูุง ูุชุฎุตุต
- [ ] ุจูโุฑูุฒุฑุณุงู ูพุฑุงููพุชโูุง ุจุฑุง ุชุดุฎุต ุจูุชุฑ ุงุจุฒุงุฑูุง
- [ ] ุงุถุงูู ฺฉุฑุฏู ูุซุงูโูุง ุชุดุฎุต
- [ ] ุจูุจูุฏ ุฏุณุชูุฑุงูุนููโูุง ูพุงุณุฎโุฏู

### ุชุณฺฉ ด: ุชุณุช ู ุงุนุชุจุงุฑุณูุฌ
- [ ] ุชุณุช ุจุง ุณูุงูุงุช ูุฎุชูู ูุงู
- [ ] ุงุนุชุจุงุฑุณูุฌ ุชุตููโฺฏุฑ ุณุณุชู
- [ ] ุจูููโุณุงุฒ ุขุณุชุงููโูุง

### ุชุณฺฉ ต: ูุณุชูุฏุณุงุฒ
- [ ] ูุณุชูุฏุณุงุฒ ุณุณุชู ุฌุฏุฏ
- [ ] ุงุฌุงุฏ ุฑุงูููุง ุชูุณุนู ุงุจุฒุงุฑูุง ุฌุฏุฏ
- [ ] ุจูโุฑูุฒุฑุณุงู ูุงูโูุง context

## ๐๏ธ ูุนูุงุฑ ูพุดููุงุฏ

### ฑ. ุณุณุชู ุชุดุฎุต ุงุจุฒุงุฑูุง
```python
def _detect_tools_needed(question: str, classification: Dict) -> Dict:
    """
    ุชุดุฎุต ุงูฺฉู ฺฉุฏุงู ุงุจุฒุงุฑ ุจุฑุง ุณูุงู ููุงุณุจ ุงุณุช
    """
    # 1. ุงุณุชุฎุฑุงุฌ ฺฉููุงุช ฺฉูุฏ ุงุฒ ุณูุงู
    # 2. ุชุทุจู ุจุง ุชูุถุญุงุช ุงุจุฒุงุฑูุง
    # 3. ูุญุงุณุจู ุงูุชุงุฒ ุจุฑุง ูุฑ ุงุจุฒุงุฑ
    # 4. ุงูุชุฎุงุจ ุงุจุฒุงุฑ ุจุง ุจุงูุงุชุฑู ุงูุชุงุฒ
```

### ฒ. ุณุณุชู ุชุตููโฺฏุฑ
```python
def _decide_tool_or_deepseek(question: str) -> str:
    """
    ุชุตููโฺฏุฑ ููุดููุฏ ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑ ุง DeepSeek
    """
    # 1. ุทุจููโุจูุฏ ุณูุงู
    classification = self._classify_question_type(question)
    
    # 2. ุชุดุฎุต ุงุจุฒุงุฑูุง ููุงุณุจ
    tools_analysis = self._detect_tools_needed(question, classification)
    
    # 3. ุชุตููโฺฏุฑ ุจุฑ ุงุณุงุณ ุขุณุชุงููโูุง
    if tools_analysis['best_tool_score'] >= TOOL_THRESHOLD:
        return "USE_TOOL"
    elif classification['is_financial_related']:
        return "USE_DEEPSEEK"
    else:
        return "USE_FALLBACK"
```

### ณ. ูพุฑุงููพุช ููุดููุฏ ุชุดุฎุต
```
ุดูุง ฺฉ ุณุณุชู ููุดููุฏ ุชุดุฎุต ุงุจุฒุงุฑูุง ูุงู ูุณุชุฏ. ูุธูู ุดูุง ุชุญูู ุณูุงูุงุช ฺฉุงุฑุจุฑ ู ุชุดุฎุต ุงู ุงุณุช ฺฉู:

1. ุขุง ุณูุงู ูุฑุจูุท ุจู ุฏุงุฏูโูุง ูุงู ููุฌูุฏ ุงุณุชุ
   - ุชุญูู ูุณุจุชโูุง ูุงู ุงุฒ ุฏุงุฏูโูุง ูุงูุน
   - ุชููุฏ ฺฏุฒุงุฑุดโูุง ูุงู ุงุฒ ุงุณูุงุฏ ููุฌูุฏ
   - ุดูุงุณุง ุงูุญุฑุงูุงุช ุฏุฑ ุฏุงุฏูโูุง ูุนู

2. ุขุง ุณูุงู ูุฑุจูุท ุจู ุฏุงูุด ุนููู ูุงู ุงุณุชุ
   - ุชุนุงุฑู ู ููุงูู ุญุณุงุจุฏุงุฑ
   - ููุงูู ู ููุฑุฑุงุช ูุงู
   - ูุดุงูุฑู ูุงู ุนููู

ููููู ุณูุงูุงุช ุจุฑุง ุงุจุฒุงุฑูุง:
- "ูุณุจุชโูุง ูุงู ุดุฑฺฉุช ุฑุง ุชุญูู ฺฉู" โ USE_TOOL
- "ุชุฑุงุฒ ฺูุงุฑุณุชูู ูุตู ุจูุงุฑ ุฑุง ุจุฏู" โ USE_TOOL  
- "ุงูุญุฑุงูุงุช ูุงู ุฑุง ุดูุงุณุง ฺฉู" โ USE_TOOL

ููููู ุณูุงูุงุช ุจุฑุง DeepSeek:
- "ูุงูุงุช ุงุฑุฒุด ุงูุฒูุฏู ฺุณุชุ" โ USE_DEEPSEEK
- "ุงุณุชุงูุฏุงุฑุฏูุง ุญุณุงุจุฏุงุฑ ุงุฑุงู ฺฉุฏุงููุฏุ" โ USE_DEEPSEEK
- "ฺฺฏููู ุณูุฏุขูุฑ ุฑุง ุงูุฒุงุด ุฏููุ" โ USE_DEEPSEEK
```

## ๐ง ูพุงุฏูโุณุงุฒ ูู

### ฑ. ุงุถุงูู ฺฉุฑุฏู ุณุณุชู ุชุดุฎุต ุงุจุฒุงุฑูุง
```python
def _detect_tools_needed(self, question: str, classification: Dict) -> Dict:
    """ุชุดุฎุต ุงุจุฒุงุฑูุง ููุงุณุจ ุจุฑุง ุณูุงู"""
    question_lower = question.lower()
    tool_scores = {}
    
    for tool_name, tool_info in TOOL_DESCRIPTIONS.items():
        score = 0
        # ุงูุชุงุฒ ุจุฑ ุงุณุงุณ ฺฉููุงุช ฺฉูุฏ
        for keyword in tool_info['keywords']:
            if keyword in question_lower:
                score += 2
        
        # ุงูุชุงุฒ ุจุฑ ุงุณุงุณ ูุซุงูโูุง
        for example in tool_info['examples']:
            if any(word in question_lower for word in example.lower().split()):
                score += 1
        
        tool_scores[tool_name] = score
    
    # ูพุฏุง ฺฉุฑุฏู ุงุจุฒุงุฑ ุจุง ุจุงูุงุชุฑู ุงูุชุงุฒ
    best_tool = max(tool_scores.items(), key=lambda x: x[1])
    
    return {
        'tool_scores': tool_scores,
        'best_tool': best_tool[0] if best_tool[1] > 0 else None,
        'best_tool_score': best_tool[1]
    }
```

### ฒ. ุขุณุชุงููโูุง ุชุตููโฺฏุฑ
```python
# ุขุณุชุงููโูุง ุณุณุชู
TOOL_THRESHOLD = 3  # ุญุฏุงูู ุงูุชุงุฒ ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑ
DEEPSEEK_THRESHOLD = 1  # ุญุฏุงูู ุงูุชุงุฒ ูุงู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ DeepSeek
```

## ๐ ูุนุงุฑูุง ููููุช

- **ุฏูุช ุชุดุฎุต ุงุจุฒุงุฑูุง**: โฅ 90%
- **ุฒูุงู ูพุงุณุฎโุฏู**: < 2 ุซุงูู  
- **ูพูุดุด ุณูุงูุงุช ูุงู**: 100%
- **ูุฏุฑุช ุฎุทุง**: ูพุงุณุฎ fallback ุจุฑุง ุณูุงูุงุช ุบุฑูุงู

## ๐ ุจุฑูุงูู ุงุฌุฑุง

### ูุงุฒ ฑ: ุทุฑุงุญ ู ูพุงุฏูโุณุงุฒ (ฒ ุฑูุฒ)
- ุทุฑุงุญ ุณุณุชู ุชุดุฎุต ุงุจุฒุงุฑูุง
- ูพุงุฏูโุณุงุฒ ููุทู ุชุตููโฺฏุฑ
- ุชุณุช ุงููู

### ูุงุฒ ฒ: ุจูููโุณุงุฒ (ฑ ุฑูุฒ)
- ุชูุธู ุขุณุชุงููโูุง
- ุจูุจูุฏ ูพุฑุงููพุชโูุง
- ุชุณุช ฺฏุณุชุฑุฏู

### ูุงุฒ ณ: ูุณุชูุฏุณุงุฒ (ฐ.ต ุฑูุฒ)
- ูุณุชูุฏุณุงุฒ ุณุณุชู
- ุงุฌุงุฏ ุฑุงูููุงูุง
- ุจูโุฑูุฒุฑุณุงู context

## ๐ก ูฺฉุงุช ฺฉูุฏ

1. **ุงุฌุชูุงุจ ุงุฒ ฺฉุฏ ุชฺฉุฑุงุฑ**: ุงุณุชูุงุฏู ุงุฒ ูุงฺููโูุง ููุฌูุฏ
2. **ูุงุจูุช ุชูุณุนู**: ุทุฑุงุญ ุจุฑุง ุงุถุงูู ุดุฏู ุงุจุฒุงุฑูุง ุฌุฏุฏ
3. **ฺฉุงุฑุง**: ุจูููโุณุงุฒ ุณุฑุนุช ูพุฑุฏุงุฒุด
4. **ูุงุจูุช ุงุทููุงู**: ูุฏุฑุช ุฎุทุงูุง ูุฎุชูู

ุงู ุณุณุชู ููุจ ููุดููุฏ ุณุณุชู ูุงู ุฎูุงูุฏ ุจูุฏ ู ูุงุจูุช ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุงุจุฒุงุฑูุง ููุงุณุจ ุฑุง ูุฑุงูู ูโฺฉูุฏ.
