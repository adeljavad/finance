عالی؛ حالا دیتای «سربرگ + آرتیکل» دست‌مان است و جنگو‌امون هم آماده‌است.
برای این‌که ۵۰ تسک «الگوریتم اصلی حسابرسی» را دقیقاً روی همین ساختار بنویسیم، ابتدا یک چارچوب ۳‌لایه تعریف می‌کنم و بعد هر تسک را یک‌خط‌کد-قابل‌اجرا (یا الگوریتم مشخص) همراه با خروجی مدل Django‌-محور می‌سازم.
تمام تسک‌ها از شماره‌ی ۱ تا ۵۰ شماره‌گذاری شده و هر کدام:
عنوان فارسی
عنوان انگلیسی (برای نام تابع/ماژول)
ورودی دقیق (QuerySet یا DataFrame)
خروجی دقیق (مدل یا فایل یا API)
یک‌خط کد شروع (Ready-to-paste)
شروع می‌کنیم؛ هر تسک که خواستی همین حالا می‌توانیم پیاده‌سازی‌اش کنیم.
لایه‌بندی ۵۰ تسک
L1  > Integrity & Completeness (۱-۱۰)
L2  > Accuracy & Posting (۱۱-۲۰)
L3  > Analytical Procedures (۲۱-۳۰)
L4  > Fraud & Exception (۳۱-۴۰)
L5  > Compliance & Reporting (۴۱-۵۰)
۱) تراز بودن هر سند (Balance Check)
en: balance_check
in:  DocumentHeader.objects.filter(period=period)
out: List[dict] → {doc_id, diff}
code:
Python
Copy
diff = F('total_debit') - F('total_credit')
qs = DocumentHeader.objects.annotate(diff=diff).exclude(diff=0)
۲) آرتیکل‌های بدون شرح (Missing Description)
en: empty_description_items
in:  DocumentItem.objects.all()
out: QuerySet
code:
Python
Copy
qs = DocumentItem.objects.filter(
     Q(description__isnull=True) | Q(description='')
)
۳) اسناد بدون آرتیکل (Empty Document)
en: orphan_header
in:  DocumentHeader.objects.all()
out: QuerySet
code:
Python
Copy
qs = DocumentHeader.objects.filter(items__isnull=True)
۴) مبالغ منفی در بدهکار / بستانکار
en: negative_amount_check
in:  DocumentItem.objects.all()
out: List[dict]
code:
Python
Copy
qs = DocumentItem.objects.filter(
     Q(debit__lt=0) | Q(credit__lt=0)
)
۵) تکرار شماره سند در یک دوره
en: duplicate_doc_number
in:  DocumentHeader.objects.filter(period=p)
out: ValuesList
code:
Python
Copy
dup = (DocumentHeader.objects.filter(period=p)
       .values('document_number')
       .annotate(c=Count('id'))
       .filter(c__gt=1))
۶) مجموع بدهکار = بستانکار در سطح دوره
en: period_balance_sum
in:  DocumentItem.objects.filter(document__period=p)
out: Bool
code:
Python
Copy
agg = DocumentItem.objects.filter(
     document__period=p
).aggregate(
     td=Coalesce(Sum('debit'), 0),
     tc=Coalesce(Sum('credit'), 0)
)
ok = agg['td'] == agg['tc']
۷) اسناد تاریخ‌گذشته (Back-Dating)
en: back_date_check
in:  DocumentHeader.objects.all()
out: QuerySet
code:
Python
Copy
qs = DocumentHeader.objects.filter(
     document_date__lt=period.start_date
) | DocumentHeader.objects.filter(
     document_date__gt=period.end_date
)
۸) اسناد بلانک بدون توضیح
en: blank_header_description
in:  DocumentHeader.objects.all()
out: QuerySet
code:
Python
Copy
qs = DocumentHeader.objects.filter(
     Q(description='') | Q(description__isnull=True)
)
۹) آرتیکل‌های بدون حساب معین
en: missing_account
in:  DocumentItem.objects.all()
out: QuerySet
code:
Python
Copy
qs = DocumentItem.objects.filter(account__isnull=True)
۱۰) Sequence Gap در شماره اسناد
en: sequence_gap
in:  DocumentHeader.objects.filter(period=p).order_by('document_number')
out: List[str] → missing numbers
code:
Copy
 
python
    nums = list(qs.values_list('document_number', flat=True))
    missing = sorted(set(range(min(nums), max(nums)+1)) - set(nums))
    
۱۱) تطابق ماهیت حساب با بدهکار/بستانکار
en: account_nature_vs_dc
in:  DocumentItem.objects.select_related('account')
out: List[dict]
code:
```python
errors = []