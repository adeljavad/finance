در ادامه‌ی ۵۰ تسک قبلی، ۱۰ تسک بعدی (۵۱–۶۰) را می‌نویسم؛ همگی «قابل‌اجرا» روی همان مدل‌های Django که دادی و دیتای موجود، و همگی با یک خط شروع کد یا کوئری مشخص.  
هرکدام را خواستی فوراً می‌توانیم تبدیل به فایل واقعی (management-command / Celery-task / DRF API) کنیم.

---

۵۱) **شبیه‌سازی جریان وجوه نقد (Cash-Flow Indirect)**  
en: `cash_flow_indirect`  
in: DocumentItem (دوره جاری + دوره قبل)  
out: dict{Operating, Investing, Financing}  
code:  
```python
from django.db.models import Sum, Q, F, Value, DecimalField
from django.db.models.functions import Coalesce

def cash_flow_indirect(period):
    # Net Income ≈ P&L Credit – P&L Debit
    pnl_accounts = ChartOfAccounts.objects.filter(group__in=['Revenue','Expense'])
    net = (DocumentItem.objects
           .filter(document__period=period, account__in=pnl_accounts)
           .aggregate(
               cr=Coalesce(Sum('credit'), 0),
               dr=Coalesce(Sum('debit'), 0)
            ))
    net_income = net['cr'] - net['dr']

    # Depreciation & Amortisation (add back)
    dep = (DocumentItem.objects
           .filter(account__code__startswith='69', document__period=period)
           .aggregate(s=Coalesce(Sum('debit'), 0))['s'])

    # ΔWorking-Capital
    wc_codes = ['11','12','13','14','15','16','17']  # receivables, inventory, payables
    wc = (DocumentItem.objects
          .filter(account__code__startswith=wc_codes, document__period=period)
          .aggregate(
              delta_dr=Coalesce(Sum('debit'), 0),
              delta_cr=Coalesce(Sum('credit'), 0)
          ))
    delta_wc = wc['delta_dr'] - wc['delta_cr']

    operating = net_income + dep - delta_wc
    return {'Operating': operating, 'Investing': 0, 'Financing': 0}  # Investing/Financing در تسک بعد
```

---

۵۲) **تفکیک جریان وجوه نقد سرمایه‌گذاری / تأمین مالی**  
en: `cash_flow_inv_fin`  
in: DocumentItem (حساب‌های ۳۱–۳۹ و ۴۱–۴۹)  
out: dict{Investing, Financing}  
code:  
```python
inv = (DocumentItem.objects
       .filter(account__code__startswith=['31','32','33','34'], document__period=period)
       .aggregate(s=Coalesce(Sum('debit'), 0) - Coalesce(Sum('credit'), 0))['s'])
fin = (DocumentItem.objects
       .filter(account__code__startswith=['41','42','43','44'], document__period=period)
       .aggregate(s=Coalesce(Sum('credit'), 0) - Coalesce(Sum('debit'), 0))['s'])
return {'Investing': inv or 0, 'Financing': fin or 0}
```

---

۵۳) **محاسبه نسبت جاری (Current Ratio)**  
en: `current_ratio`  
in: DocumentItem پایان‌دوره  
out: float  
code:  
```python
current_assets = DocumentItem.objects.filter(
    account__code__startswith=['11','12','13'], document__period=period
).aggregate(s=Coalesce(Sum('debit'), 0) - Coalesce(Sum('credit'), 0))['s'] or 0

current_liab = DocumentItem.objects.filter(
    account__code__startswith=['21','22'], document__period=period
).aggregate(s=Coalesce(Sum('credit'), 0) - Coalesce(Sum('debit'), 0))['s'] or 0

ratio = current_assets / current_liab if current_liab else None
```

---

۵۴) **محاسبه نسبت آنی (Quick Ratio)**  
en: `quick_ratio`  
out: float (Inventory excluded)  
code:  
```python
inventory = DocumentItem.objects.filter(
    account__code__startswith='14', document__period=period
).aggregate(s=Coalesce(Sum('debit'), 0) - Coalesce(Sum('credit'), 0))['s'] or 0
quick = (current_assets - inventory) / current_liab if current_liab else None
```

---

۵۵) **گردش موجودی کالا (Inventory Turnover)**  
en: `inventory_turnover`  
in: COGS & Average Inventory  
out: float  
code:  
```python
cogs = DocumentItem.objects.filter(
    account__code__startswith='61', document__period=period
).aggregate(s=Coalesce(Sum('debit'), 0))['s'] or 0

avg_inv = (
    DocumentItem.objects.filter(account__code__startswith='14', document__period__in=[prev, current])
    .aggregate(s=Coalesce(Sum('debit'), 0) - Coalesce(Sum('credit'), 0))['s'] or 0
) / 2

turnover = cogs / avg_inv if avg_inv else None
```

---

۵۶) **ROI حساب‌های دریافتنی (Receivable ROI)**  
en: `ar_roi`  
out: float  
code:  
```python
net_credit_sales = DocumentItem.objects.filter(
    account__code__startswith='31', document__period=period
).aggregate(s=Coalesce(Sum('credit'), 0))['s'] or 0

avg_ar = DocumentItem.objects.filter(
    account__code__startswith='11', document__period__in=[prev, current]
).aggregate(
    s=Coalesce(Sum('debit'), 0) - Coalesce(Sum('credit'), 0)
)['s'] or 0
avg_ar /= 2

roi = net_credit_sales / avg_ar if avg_ar else None
```

---

۵۷) **نسبت بدهی به حقوق صاحبان سهام (Debt-to-Equity)**  
en: `debt_to_equity`  
out: float  
code:  
```python
total_liab = DocumentItem.objects.filter(
    account__code__startswith='2', document__period=period
).aggregate(s=Coalesce(Sum('credit'), 0) - Coalesce(Sum('debit'), 0))['s'] or 0

equity = DocumentItem.objects.filter(
    account__code__startswith='4', document__period=period
).aggregate(s=Coalesce(Sum('credit'), 0) - Coalesce(Sum('debit'), 0))['s'] or 0

ratio = total_liab / equity if equity else None
```

---

۵۸) **Coverage Ratio (EBITDA / Interest)**  
en: `interest_coverage`  
out: float  
code:  
```python
ebitda = DocumentItem.objects.filter(
    account__code__startswith=['31','32','61'], document__period=period
).aggregate(
    cr=Coalesce(Sum('credit'), 0),
    dr=Coalesce(Sum('debit'), 0)
)
ebitda = ebitda['cr'] - ebitda['dr']

interest_exp = DocumentItem.objects.filter(
    account__code__startswith='47', document__period=period
).aggregate(s=Coalesce(Sum('debit'), 0))['s'] or 0

coverage = ebitda / interest_exp if interest_exp else None
```

---

۵۹) **نرخ بازده دارایی (ROA)**  
en: `roa`  
out: float  
code:  
```python
net_income = ...  # از تسک ۵۱
avg_assets = DocumentItem.objects.filter(
    account__code__startswith='1', document__period__in=[prev, current]
).aggregate(
    s=Coalesce(Sum('debit'), 0) - Coalesce(Sum('credit'), 0)
)['s'] or 0
avg_assets /= 2

roa = net_income / avg_assets if avg_assets else None
```

---

۶۰) **نرخ بازده حقوق صاحبان سهام (ROE)**  
en: `roe`  
out: float  
code:  
```python
avg_equity = DocumentItem.objects.filter(
    account__code__startswith='4', document__period__in=[prev, current]
).aggregate(
    s=Coalesce(Sum('credit'), 0) - Coalesce(Sum('debit'), 0)
)['s'] or 0
avg_equity /= 2

roe = net_income / avg_equity if avg_equity else None
```

---

### بعدی چی؟  
هرکدام از این ۱۰ تسک را که خواستی:
- تبدیلش می‌کنیم به یک `management command` (python manage.py audit_cash_flow)  
 یا  
- یک Celery-Task با نتیجه‌ای که در مدل `AuditResult` ذخیره می‌شود  
 یا  
- یک API با DRF که JSON خروجی را می‌دهد و در Dashboard لنگ‌چین نمایش می‌دهی.

فقط بگو «تسک ۵۲ رو بزن» یا «ROA رو می‌خوام توی Celery»؛ بلافاصله کد کامل + تستش رو می‌سازیم.