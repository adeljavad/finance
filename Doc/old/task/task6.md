# ğŸ¯ ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ Ú†Ù†Ø¯ Ø´Ø±Ú©ØªÛŒ

## ğŸ“‹ **ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ** (ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Û³Û°Û±-Û³Û²Û°)

### **ÙØ§Ø² Û±-Ø§Ù„Ù: ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¬ÛŒÙ…ÛŒÙ„** (ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Û³Û°Û±-Û³Û°Ûµ)

```
301. **Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ django-allauth Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ**
302. **Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Google OAuth2 Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ú¯ÙˆÚ¯Ù„**
303. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø¬ÛŒÙ…ÛŒÙ„**
304. **Ø§ÛŒØ¬Ø§Ø¯ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…ØªØµÙ„ (Google + Ù…Ø­Ù„ÛŒ)**
305. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ merge accounts Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ú†Ù†Ø¯ÛŒÙ† Ø±ÙˆØ´ ÙˆØ±ÙˆØ¯**
```

### **ÙØ§Ø² Û±-Ø¨: Ù…Ø¯Ù„â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆØ§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±-Ø´Ø±Ú©Øª** (ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Û³Û°Û¶-Û³Û±Û°)

```
306. **Ø·Ø±Ø§Ø­ÛŒ Ù…Ø¯Ù„ Company Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§**
307. **Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¯Ù„ UserCompanyRole Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ú†Ù†Ø¯ Ø´Ø±Ú©ØªÛŒ**
308. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¯Ù„ FinancialPeriod Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ**
309. **Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¯Ù„ UserPermission Ø¨Ø±Ø§ÛŒ Ø³Ø·ÙˆØ­ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡**
310. **Ø·Ø±Ø§Ø­ÛŒ Ø³ÛŒØ³ØªÙ… invite Ùˆ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§**
```

### **ÙØ§Ø² Û±-Ø¬: Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒ Ùˆ Ù¾Ø±Ù…ÛŒÚ˜Ù†â€ŒÙ‡Ø§** (ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Û³Û±Û±-Û³Û±Ûµ)

```
311. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… RBAC (Role-Based Access Control)**
312. **Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±Ù…ÛŒÚ˜Ù†â€ŒÙ‡Ø§ÛŒ Ø³Ø·Ø­ Ø´Ø±Ú©Øª Ùˆ Ø³Ø·Ø­ Ø¯ÙˆØ±Ù‡ Ù…Ø§Ù„ÛŒ**
313. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒØ¯Ù„ÙˆØ± Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§**
314. **Ø§ÛŒØ¬Ø§Ø¯ ÙˆÛŒÙˆÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§ÛŒ Ø´Ø±Ú©Øª**
315. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… invite Ù„ÛŒÙ†Ú© Ø¨Ø±Ø§ÛŒ Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§**
```

### **ÙØ§Ø² Û±-Ø¯: Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ** (ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Û³Û±Û¶-Û³Û²Û°)

```
316. **Ø§ÛŒØ¬Ø§Ø¯ ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø±Ú©Øª Ù¾Ø³ Ø§Ø² ÙˆØ±ÙˆØ¯**
317. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³ÙˆØ¦ÛŒÚ† Ø¨ÛŒÙ† Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù**
318. **Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø±Ú©Øª Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§**
319. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø³Ø·Ø­ Ø´Ø±Ú©Øª**
320. **Ø§ÛŒØ¬Ø§Ø¯ Ø³ÛŒØ³ØªÙ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ø¯Ø¹ÙˆØªâ€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø±Ú©Øª**
```

## ğŸ—ƒï¸ **Ú©Ø¯Ù‡Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ:**

### **Û±. Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§**

```python
# users/models.py
from django.contrib.auth.models import AbstractUser
from django.db import models
from django.utils import timezone

class CustomUser(AbstractUser):
    phone = models.CharField(max_length=15, blank=True)
    avatar = models.ImageField(upload_to='avatars/', null=True, blank=True)
    email_verified = models.BooleanField(default=False)
    
    def __str__(self):
        return f"{self.username} - {self.email}"

class Company(models.Model):
    COMPANY_TYPES = [
        ('MANUFACTURING', 'ØªÙˆÙ„ÛŒØ¯ÛŒ'),
        ('TRADING', 'Ø¨Ø§Ø²Ø±Ú¯Ø§Ù†ÛŒ'),
        ('SERVICE', 'Ø®Ø¯Ù…Ø§ØªÛŒ'),
        ('CONSTRUCTION', 'Ù¾ÛŒÙ…Ø§Ù†Ú©Ø§Ø±ÛŒ'),
    ]
    
    name = models.CharField(max_length=200, verbose_name='Ù†Ø§Ù… Ø´Ø±Ú©Øª')
    economic_code = models.CharField(max_length=20, verbose_name='Ú©Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ', unique=True)
    national_code = models.CharField(max_length=20, verbose_name='Ø´Ù†Ø§Ø³Ù‡ Ù…Ù„ÛŒ', unique=True)
    company_type = models.CharField(max_length=20, choices=COMPANY_TYPES, verbose_name='Ù†ÙˆØ¹ Ø´Ø±Ú©Øª')
    address = models.TextField(verbose_name='Ø¢Ø¯Ø±Ø³')
    phone = models.CharField(max_length=15, verbose_name='ØªÙ„ÙÙ†')
    website = models.URLField(blank=True, verbose_name='ÙˆØ¨Ø³Ø§ÛŒØª')
    logo = models.ImageField(upload_to='company_logos/', null=True, blank=True, verbose_name='Ù„ÙˆÚ¯Ùˆ')
    is_active = models.BooleanField(default=True, verbose_name='ÙØ¹Ø§Ù„')
    created_by = models.ForeignKey(CustomUser, on_delete=models.CASCADE, related_name='created_companies')
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        verbose_name = 'Ø´Ø±Ú©Øª'
        verbose_name_plural = 'Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§'
        ordering = ['name']
    
    def __str__(self):
        return self.name

class FinancialPeriod(models.Model):
    company = models.ForeignKey(Company, on_delete=models.CASCADE, related_name='financial_periods')
    name = models.CharField(max_length=100, verbose_name='Ù†Ø§Ù… Ø¯ÙˆØ±Ù‡')
    start_date = models.DateField(verbose_name='ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹')
    end_date = models.DateField(verbose_name='ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†')
    is_active = models.BooleanField(default=True, verbose_name='ÙØ¹Ø§Ù„')
    is_closed = models.BooleanField(default=False, verbose_name='Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡')
    created_by = models.ForeignKey(CustomUser, on_delete=models.CASCADE)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        verbose_name = 'Ø¯ÙˆØ±Ù‡ Ù…Ø§Ù„ÛŒ'
        verbose_name_plural = 'Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ'
        unique_together = ['company', 'name']
        ordering = ['-start_date']
    
    def __str__(self):
        return f"{self.name} - {self.company.name}"

class UserCompanyRole(models.Model):
    ROLE_CHOICES = [
        ('OWNER', 'Ù…Ø§Ù„Ú©'),
        ('ADMIN', 'Ù…Ø¯ÛŒØ±'),
        ('ACCOUNTANT', 'Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±'),
        ('AUDITOR', 'Ø­Ø³Ø§Ø¨Ø±Ø³'),
        ('VIEWER', 'Ù…Ø´Ø§Ù‡Ø¯Ù‡â€ŒÚ©Ù†Ù†Ø¯Ù‡'),
    ]
    
    user = models.ForeignKey(CustomUser, on_delete=models.CASCADE, related_name='company_roles')
    company = models.ForeignKey(Company, on_delete=models.CASCADE, related_name='user_roles')
    role = models.CharField(max_length=20, choices=ROLE_CHOICES, verbose_name='Ù†Ù‚Ø´')
    is_active = models.BooleanField(default=True, verbose_name='ÙØ¹Ø§Ù„')
    invited_by = models.ForeignKey(CustomUser, on_delete=models.SET_NULL, null=True, related_name='sent_invitations')
    invited_at = models.DateTimeField(auto_now_add=True)
    joined_at = models.DateTimeField(null=True, blank=True)
    
    class Meta:
        verbose_name = 'Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø´Ø±Ú©Øª'
        verbose_name_plural = 'Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§'
        unique_together = ['user', 'company']
    
    def __str__(self):
        return f"{self.user.username} - {self.company.name} - {self.get_role_display()}"

class CompanyInvitation(models.Model):
    STATUS_CHOICES = [
        ('PENDING', 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±'),
        ('ACCEPTED', 'Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡'),
        ('REJECTED', 'Ø±Ø¯ Ø´Ø¯Ù‡'),
        ('EXPIRED', 'Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡'),
    ]
    
    email = models.EmailField(verbose_name='Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø¹ÙˆØª Ø´Ø¯Ù‡')
    company = models.ForeignKey(Company, on_delete=models.CASCADE, related_name='invitations')
    role = models.CharField(max_length=20, choices=UserCompanyRole.ROLE_CHOICES, verbose_name='Ù†Ù‚Ø´')
    invited_by = models.ForeignKey(CustomUser, on_delete=models.CASCADE, related_name='company_invitations')
    token = models.CharField(max_length=100, unique=True, verbose_name='ØªÙˆÚ©Ù† Ø¯Ø¹ÙˆØª')
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='PENDING', verbose_name='ÙˆØ¶Ø¹ÛŒØª')
    expires_at = models.DateTimeField(verbose_name='ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§')
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        verbose_name = 'Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡ Ø´Ø±Ú©Øª'
        verbose_name_plural = 'Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø±Ú©Øª'
    
    def is_expired(self):
        return timezone.now() > self.expires_at
    
    def __str__(self):
        return f"{self.email} - {self.company.name} - {self.get_role_display()}"

class UserSession(models.Model):
    """Ù…Ø¯Ù„ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª session Ú©Ø§Ø±Ø¨Ø± Ø¨ÛŒÙ† Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù"""
    user = models.ForeignKey(CustomUser, on_delete=models.CASCADE, related_name='sessions')
    company = models.ForeignKey(Company, on_delete=models.CASCADE, null=True, blank=True)
    financial_period = models.ForeignKey(FinancialPeriod, on_delete=models.SET_NULL, null=True, blank=True)
    last_activity = models.DateTimeField(auto_now=True)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        verbose_name = 'Ø³Ø´Ù† Ú©Ø§Ø±Ø¨Ø±'
        verbose_name_plural = 'Ø³Ø´Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†'
    
    def __str__(self):
        return f"{self.user.username} - {self.company.name if self.company else 'No Company'}"
```

### **Û². Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ django-allauth Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¬ÛŒÙ…ÛŒÙ„**

```python
# settings.py
INSTALLED_APPS = [
    # ...
    'django.contrib.sites',
    
    # allauth apps
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'allauth.socialaccount.providers.google',
    
    'users',
]

AUTHENTICATION_BACKENDS = [
    'django.contrib.auth.backends.ModelBackend',
    'allauth.account.auth_backends.AuthenticationBackend',
]

AUTH_USER_MODEL = 'users.CustomUser'

# Allauth Settings
SITE_ID = 1
ACCOUNT_EMAIL_REQUIRED = True
ACCOUNT_USERNAME_REQUIRED = False
ACCOUNT_AUTHENTICATION_METHOD = 'email'
ACCOUNT_EMAIL_VERIFICATION = 'mandatory'
ACCOUNT_UNIQUE_EMAIL = True
LOGIN_REDIRECT_URL = '/company/select/'
ACCOUNT_LOGOUT_REDIRECT_URL = '/'

# Social Auth Settings
SOCIALACCOUNT_PROVIDERS = {
    'google': {
        'SCOPE': [
            'profile',
            'email',
        ],
        'AUTH_PARAMS': {
            'access_type': 'online',
        },
        'APP': {
            'client_id': os.getenv('GOOGLE_OAUTH_CLIENT_ID'),
            'secret': os.getenv('GOOGLE_OAUTH_CLIENT_SECRET'),
            'key': ''
        }
    }
}

# Email Settings (Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„)
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = os.getenv('EMAIL_HOST_USER')
EMAIL_HOST_PASSWORD = os.getenv('EMAIL_HOST_PASSWORD')
```

### **Û³. ÙˆÛŒÙˆÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø±Ú©Øª Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§**

```python
# users/views.py
from django.contrib.auth.decorators import login_required
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib import messages
from django.http import JsonResponse
from django.views.decorators.http import require_http_methods
from .models import Company, UserCompanyRole, FinancialPeriod, CompanyInvitation, UserSession
from .forms import CompanyForm, FinancialPeriodForm, CompanyInvitationForm
import secrets
from django.utils import timezone
from datetime import timedelta

@login_required
def company_selection(request):
    """ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø±Ú©Øª Ù¾Ø³ Ø§Ø² ÙˆØ±ÙˆØ¯"""
    user_roles = UserCompanyRole.objects.filter(
        user=request.user, 
        is_active=True
    ).select_related('company')
    
    # Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± ÙÙ‚Ø· ÛŒÚ© Ø´Ø±Ú©Øª Ø¯Ø§Ø±Ø¯ØŒ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¨Ù‡ Ø¢Ù† Ù‡Ø¯Ø§ÛŒØª Ø´ÙˆØ¯
    if user_roles.count() == 1:
        company = user_roles.first().company
        return redirect('set_current_company', company_id=company.id)
    
    return render(request, 'users/company_selection.html', {
        'user_roles': user_roles
    })

@login_required
def set_current_company(request, company_id):
    """ØªÙ†Ø¸ÛŒÙ… Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±"""
    company = get_object_or_404(Company, id=company_id)
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø´Ø±Ú©Øª
    user_role = UserCompanyRole.objects.filter(
        user=request.user,
        company=company,
        is_active=True
    ).first()
    
    if not user_role:
        messages.error(request, 'Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø´Ø±Ú©Øª Ù†Ø¯Ø§Ø±ÛŒØ¯.')
        return redirect('company_selection')
    
    # Ø°Ø®ÛŒØ±Ù‡ Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ Ø¯Ø± Ø³Ø´Ù†
    request.session['current_company_id'] = company.id
    request.session['current_company_name'] = company.name
    request.session['user_role'] = user_role.role
    
    # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ UserSession
    user_session, created = UserSession.objects.get_or_create(
        user=request.user,
        defaults={'company': company}
    )
    if not created:
        user_session.company = company
        user_session.save()
    
    messages.success(request, f'Ø´Ø±Ú©Øª {company.name} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯.')
    return redirect('dashboard')  # ÛŒØ§ Ù‡Ø± ØµÙØ­Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ù¾Ø³ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø±Ú©Øª Ø¨Ø§ÛŒØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯

@login_required
def create_company(request):
    """Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø±Ú©Øª Ø¬Ø¯ÛŒØ¯ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±"""
    if request.method == 'POST':
        form = CompanyForm(request.POST, request.FILES)
        if form.is_valid():
            company = form.save(commit=False)
            company.created_by = request.user
            company.save()
            
            # Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´ Ù…Ø§Ù„Ú© Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
            UserCompanyRole.objects.create(
                user=request.user,
                company=company,
                role='OWNER'
            )
            
            messages.success(request, 'Ø´Ø±Ú©Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.')
            return redirect('company_selection')
    else:
        form = CompanyForm()
    
    return render(request, 'users/create_company.html', {'form': form})

@login_required
def manage_company_members(request, company_id):
    """Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§ÛŒ Ø´Ø±Ú©Øª"""
    company = get_object_or_404(Company, id=company_id)
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± (ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø§Ø¹Ø¶Ø§ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ù†Ø¯)
    user_role = get_object_or_404(UserCompanyRole, user=request.user, company=company)
    if user_role.role not in ['OWNER', 'ADMIN']:
        messages.error(request, 'Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯.')
        return redirect('dashboard')
    
    members = UserCompanyRole.objects.filter(company=company, is_active=True)
    invitations = CompanyInvitation.objects.filter(company=company, status='PENDING')
    
    if request.method == 'POST':
        invitation_form = CompanyInvitationForm(request.POST)
        if invitation_form.is_valid():
            invitation = invitation_form.save(commit=False)
            invitation.company = company
            invitation.invited_by = request.user
            invitation.token = secrets.token_urlsafe(32)
            invitation.expires_at = timezone.now() + timedelta(days=7)
            invitation.save()
            
            # Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø¹ÙˆØª (Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´ÙˆØ¯)
            # send_invitation_email(invitation)
            
            messages.success(request, 'Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.')
            return redirect('manage_company_members', company_id=company.id)
    else:
        invitation_form = CompanyInvitationForm()
    
    return render(request, 'users/manage_members.html', {
        'company': company,
        'members': members,
        'invitations': invitations,
        'invitation_form': invitation_form,
        'user_role': user_role
    })

@login_required
def accept_invitation(request, token):
    """Ù¾Ø°ÛŒØ±Ø´ Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡ Ø´Ø±Ú©Øª"""
    invitation = get_object_or_404(CompanyInvitation, token=token)
    
    if invitation.is_expired():
        invitation.status = 'EXPIRED'
        invitation.save()
        messages.error(request, 'Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.')
        return redirect('dashboard')
    
    if invitation.status != 'PENDING':
        messages.error(request, 'Ø§ÛŒÙ† Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.')
        return redirect('dashboard')
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø¹ÙˆØª Ø´Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª
    try:
        user = CustomUser.objects.get(email=invitation.email)
    except CustomUser.DoesNotExist:
        messages.error(request, 'Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„ÛŒ Ú©Ù‡ Ø¯Ø¹ÙˆØª Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯.')
        return redirect('register')
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø´Ø±Ú©Øª
    UserCompanyRole.objects.create(
        user=user,
        company=invitation.company,
        role=invitation.role,
        invited_by=invitation.invited_by,
        joined_at=timezone.now()
    )
    
    invitation.status = 'ACCEPTED'
    invitation.save()
    
    messages.success(request, f'Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ø´Ø±Ú©Øª {invitation.company.name} Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ÛŒØ¯.')
    return redirect('company_selection')

@login_required
def company_dashboard(request):
    """Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ"""
    company_id = request.session.get('current_company_id')
    if not company_id:
        return redirect('company_selection')
    
    company = get_object_or_404(Company, id=company_id)
    user_role = request.session.get('user_role')
    
    # Ø¯Ø±ÛŒØ§ÙØª Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø´Ø±Ú©Øª
    financial_periods = FinancialPeriod.objects.filter(company=company)
    
    return render(request, 'users/company_dashboard.html', {
        'company': company,
        'user_role': user_role,
        'financial_periods': financial_periods
    })
```

### **Û´. Ù…ÛŒØ¯Ù„ÙˆØ± Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ**

```python
# users/middleware.py
from django.shortcuts import redirect
from django.urls import reverse
from .models import UserCompanyRole

class CompanyAccessMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response
    
    def __call__(self, request):
        # Ù„ÛŒØ³Øª URLÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ Ù†Ø¯Ø§Ø±Ù†Ø¯
        exempt_urls = [
            '/accounts/',
            '/company/select/',
            '/company/create/',
            '/invitation/',
            '/admin/',
        ]
        
        current_path = request.path
        
        # Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡ Ùˆ Ù…Ø³ÛŒØ± Ù…Ø¹Ø§Ù Ù†ÛŒØ³Øª
        if (request.user.is_authenticated and 
            not any(current_path.startswith(url) for url in exempt_urls) and
            current_path != '/'):
            
            # Ø§Ú¯Ø± Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª
            if not request.session.get('current_company_id'):
                return redirect('company_selection')
            
            # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ
            company_id = request.session.get('current_company_id')
            has_access = UserCompanyRole.objects.filter(
                user=request.user,
                company_id=company_id,
                is_active=True
            ).exists()
            
            if not has_access:
                # Ø­Ø°Ù Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ Ø§Ø² Ø³Ø´Ù†
                del request.session['current_company_id']
                del request.session['current_company_name']
                del request.session['user_role']
                messages.error(request, 'Ø¯Ø³ØªØ±Ø³ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ Ø´Ø±Ú©Øª Ø¬Ø§Ø±ÛŒ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø§Ø³Øª.')
                return redirect('company_selection')
        
        response = self.get_response(request)
        return response
```

### **Ûµ. ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯**

```python
# users/forms.py
from django import forms
from .models import Company, FinancialPeriod, CompanyInvitation

class CompanyForm(forms.ModelForm):
    class Meta:
        model = Company
        fields = ['name', 'economic_code', 'national_code', 'company_type', 
                 'address', 'phone', 'website', 'logo']
        widgets = {
            'name': forms.TextInput(attrs={'class': 'form-control'}),
            'economic_code': forms.TextInput(attrs={'class': 'form-control'}),
            'national_code': forms.TextInput(attrs={'class': 'form-control'}),
            'company_type': forms.Select(attrs={'class': 'form-control'}),
            'address': forms.Textarea(attrs={'class': 'form-control', 'rows': 3}),
            'phone': forms.TextInput(attrs={'class': 'form-control'}),
            'website': forms.URLInput(attrs={'class': 'form-control'}),
        }

class FinancialPeriodForm(forms.ModelForm):
    class Meta:
        model = FinancialPeriod
        fields = ['name', 'start_date', 'end_date']
        widgets = {
            'name': forms.TextInput(attrs={'class': 'form-control'}),
            'start_date': forms.DateInput(attrs={'class': 'form-control', 'type': 'date'}),
            'end_date': forms.DateInput(attrs={'class': 'form-control', 'type': 'date'}),
        }

class CompanyInvitationForm(forms.ModelForm):
    class Meta:
        model = CompanyInvitation
        fields = ['email', 'role']
        widgets = {
            'email': forms.EmailInput(attrs={'class': 'form-control'}),
            'role': forms.Select(attrs={'class': 'form-control'}),
        }
```

## ğŸš€ **Ø§ÙˆÙ„ÙˆÛŒØª Ø§Ø¬Ø±Ø§:**

### **Ù‡ÙØªÙ‡ Û±: ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ OAuth**
```python
301. **Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ django-allauth**
302. **Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Google OAuth2**
303. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø¬ÛŒÙ…ÛŒÙ„**
```

### **Ù‡ÙØªÙ‡ Û²: Ù…Ø¯Ù„â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§**
```python
306. **Ø·Ø±Ø§Ø­ÛŒ Ù…Ø¯Ù„ Company**
307. **Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¯Ù„ UserCompanyRole**
308. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¯Ù„ FinancialPeriod**
```

### **Ù‡ÙØªÙ‡ Û³: Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª**
```python
316. **Ø§ÛŒØ¬Ø§Ø¯ ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø±Ú©Øª**
311. **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… RBAC**
314. **Ø§ÛŒØ¬Ø§Ø¯ ÙˆÛŒÙˆÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§ÛŒ Ø´Ø±Ú©Øª**
```

**Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ÛŒØ¯ Ø¨Ø§ ØªØ³Ú© Û³Û°Û± (Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ django-allauth) Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…ØŸ**