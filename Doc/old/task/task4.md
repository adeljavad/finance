# ุชุญูู ุฌุงูุน ูุงู ุงฺฉุณู ููฺฉุงุฑุงู ุณุณุชู ู ุทุฑุงุญ ุณุณุชู ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง

## ๐ ุชุญูู ุณุงุฎุชุงุฑ ูุงู ุงฺฉุณู ููููู

### ุณุชููโูุง ฺฉูุฏ ุดูุงุณุง ุดุฏู:

1. **ุณุชููโูุง ฺฉุฏูฺฏ ุณูุณูู ูุฑุงุชุจ:**
   - `Code1`, `Title1` โ ุณุทุญ ฺฉู
   - `Code2`, `Title2` โ ุณุทุญ ูุนู  
   - `Code3`, `Title3` โ ุณุทุญ ุชูุตู
   - `Code4`, `Title4` โ ุณุทุญ ูพุฑูฺู/ูุฑฺฉุฒ ูุฒูู

2. **ุณุชููโูุง ุดูุงุณู ุณูุฏ:**
   - `ุดูุงุณู ุณูุฏ`, `ุดูุงุฑู ุณูุฏ`, `ุชุงุฑุฎ ุณูุฏ`

3. **ุณุชููโูุง ูุงู:**
   - `ุจุฏูฺฉุงุฑ`, `ุจุณุชุงูฺฉุงุฑ`, `ูุงูุฏู`

## ๐ฏ ุทุฑุงุญ ุณุณุชู ุงุณุชุฎุฑุงุฌ ููุดููุฏ ุณุฑูุตูโูุง

### **ุชุณฺฉโูุง ุฌุฏุฏ ุจุฑุง ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง** (ุชุณฺฉโูุง ฒฐฑ-ฒฒฐ)

```
201. **ุทุฑุงุญ ุงูฺฏูุฑุชู ุดูุงุณุง ุฎูุฏฺฉุงุฑ ุณุทูุญ ฺฉุฏูฺฏ ุงุฒ ูุงู ุงฺฉุณู**
202. **ูพุงุฏูโุณุงุฒ ุณุณุชู ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง ฺฉู ุงุฒ Title1/Code1**
203. **ุงุฌุงุฏ ุณุณุชู ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง ูุนู ุงุฒ Title2/Code2**
204. **ูพุงุฏูโุณุงุฒ ุณุณุชู ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง ุชูุตู ุงุฒ Title3/Code3**
205. **ุงุฌุงุฏ ฺฉูุชุฑู ุงุฑุชุจุงุท ุณูุณูู ูุฑุงุชุจ ุจู ุณุทูุญ ฺฉุฏูฺฏ**
206. **ูพุงุฏูโุณุงุฒ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ฺฉุฏูฺฏโูุง ุฌุฏุฏ ุฏุฑ ูุงูโูุง ูุงูุงูู**
207. **ุงุฌุงุฏ ุณุณุชู ูพุดููุงุฏ ูุงู ุจุฑุง ุณุฑูุตูโูุง ูุดุงุจู**
208. **ูพุงุฏูโุณุงุฒ ุงูฺฏูุฑุชู ุชุทุจู ฺฉุฏูฺฏโูุง ููุฌูุฏ ุจุง ฺฉุฏูฺฏโูุง ุฌุฏุฏ**
209. **ุงุฌุงุฏ ฺฏุฒุงุฑุด ุชุบุฑุงุช ุณุงุฎุชุงุฑ ฺฉุฏูฺฏ ุจู ุฏูุฑูโูุง ูุงู**
210. **ูพุงุฏูโุณุงุฒ ุชุฃุฏ ฺฉุงุฑุจุฑ ูุจู ุงุฒ ุงุฌุงุฏ ุณุฑูุตูโูุง ุฌุฏุฏ**
```

### **ุชุณฺฉโูุง ุงุจุฒุงุฑ LangChain** (ุชุณฺฉโูุง ฒฑฑ-ฒฒฐ)

```
211. **ุทุฑุงุญ CodingExtractorTool ุจุฑุง ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง**
212. **ูพุงุฏูโุณุงุฒ CodingValidatorTool ุจุฑุง ุงุนุชุจุงุฑุณูุฌ ุณุฑูุตูโูุง**
213. **ุงุฌุงุฏ CodingHierarchyTool ุจุฑุง ุชุญูู ุณูุณูู ูุฑุงุชุจ**
214. **ูพุงุฏูโุณุงุฒ NewCodingDetectionTool ุจุฑุง ุดูุงุณุง ุณุฑูุตูโูุง ุฌุฏุฏ**
215. **ุงุฌุงุฏ CodingSuggestionTool ุจุฑุง ูพุดููุงุฏ ูุงูโูุง ุจููู**
216. **ูพุงุฏูโุณุงุฒ AutomatedCodingCreationTool ุจุฑุง ุงุฌุงุฏ ุฎูุฏฺฉุงุฑ**
217. **ุงุฌุงุฏ CodingChangeReportTool ุจุฑุง ฺฏุฒุงุฑุด ุชุบุฑุงุช**
218. **ูพุงุฏูโุณุงุฒ BulkCodingProcessorTool ุจุฑุง ูพุฑุฏุงุฒุด ฺฏุฑูู**
219. **ุงุฌุงุฏ CodingIntegrationTool ุจุฑุง ฺฉูพุงุฑฺูโุณุงุฒ ุจุง ุงุณูุงุฏ**
220. **ูพุงุฏูโุณุงุฒ CodingAuditTool ุจุฑุง ุญุณุงุจุฑุณ ุณุงุฎุชุงุฑ ฺฉุฏูฺฏ**
```

## ๐๏ธ ุทุฑุงุญ ูุฏูโูุง ูพุดุฑูุชู ุจุฑุง ฺฉุฏูฺฏ

```python
# models.py - ุชูุณุนู ูุฏู CodingStructure

class CodingStructure(models.Model):
    ACCOUNT_LEVELS = [
        ('CLASS', 'ฺฉู'),
        ('SUBCLASS', 'ูุนู'), 
        ('DETAIL', 'ุชูุตู'),
        ('PROJECT', 'ูพุฑูฺู'),
        ('COST_CENTER', 'ูุฑฺฉุฒ ูุฒูู'),
    ]
    
    code = models.CharField(max_length=50, verbose_name='ฺฉุฏ')
    name = models.CharField(max_length=200, verbose_name='ูุงู ูุงุฑุณ')
    name_en = models.CharField(max_length=200, blank=True, verbose_name='ูุงู ุงูฺฏูุณ')
    level = models.CharField(max_length=20, choices=ACCOUNT_LEVELS)
    parent = models.ForeignKey('self', on_delete=models.CASCADE, null=True, blank=True)
    is_active = models.BooleanField(default=True)
    description = models.TextField(blank=True)
    created_from_excel = models.BooleanField(default=False)
    source_file = models.ForeignKey(FinancialFile, on_delete=models.SET_NULL, null=True)
    first_seen_date = models.DateField(verbose_name='ุชุงุฑุฎ ุงููู ูุดุงูุฏู')
    last_seen_date = models.DateField(verbose_name='ุชุงุฑุฎ ุขุฎุฑู ูุดุงูุฏู')
    
    class Meta:
        unique_together = ('code', 'level')
        verbose_name = 'ุณุงุฎุชุงุฑ ฺฉุฏูฺฏ'
        verbose_name_plural = 'ุณุงุฎุชุงุฑูุง ฺฉุฏูฺฏ'

class CodingChangeLog(models.Model):
    """ุซุจุช ุชุบุฑุงุช ุณุงุฎุชุงุฑ ฺฉุฏูฺฏ"""
    CHANGE_TYPES = [
        ('NEW', 'ุณุฑูุตู ุฌุฏุฏ'),
        ('MODIFIED', 'ุชุบุฑ ูุงู'),
        ('DEACTIVATED', 'ุบุฑูุนุงู ุดุฏู'),
        ('REACTIVATED', 'ูุนุงู ุดุฏู'),
    ]
    
    coding = models.ForeignKey(CodingStructure, on_delete=models.CASCADE)
    change_type = models.CharField(max_length=20, choices=CHANGE_TYPES)
    old_value = models.TextField(blank=True)
    new_value = models.TextField(blank=True)
    changed_by = models.ForeignKey(User, on_delete=models.CASCADE)
    change_date = models.DateTimeField(auto_now_add=True)
    source_file = models.ForeignKey(FinancialFile, on_delete=models.SET_NULL, null=True)
```

## ๐ง ุทุฑุงุญ ุณุณุชู ุงุณุชุฎุฑุงุฌ ููุดููุฏ

```python
# coding_extractor.py

class IntelligentCodingExtractor:
    def __init__(self):
        self.cache = {}
        
    def extract_hierarchical_coding(self, df):
        """ุงุณุชุฎุฑุงุฌ ุณูุณูู ูุฑุงุชุจ ฺฉุฏูฺฏ ุงุฒ DataFrame"""
        codings = {
            'classes': set(),
            'subclasses': set(), 
            'details': set(),
            'projects': set()
        }
        
        for index, row in df.iterrows():
            self._extract_from_row(row, codings)
            
        return self._validate_and_structure(codings)
    
    def _extract_from_row(self, row, codings):
        """ุงุณุชุฎุฑุงุฌ ฺฉุฏูฺฏ ุงุฒ ฺฉ ุฑุฏู"""
        # ุงุณุชุฎุฑุงุฌ ุณุทุญ ฺฉู
        if pd.notna(row.get('Code1')) and pd.notna(row.get('Title1')):
            class_code = self._clean_code(row['Code1'])
            class_name = self._clean_name(row['Title1'])
            codings['classes'].add((class_code, class_name))
        
        # ุงุณุชุฎุฑุงุฌ ุณุทุญ ูุนู
        if pd.notna(row.get('Code2')) and pd.notna(row.get('Title2')):
            subclass_code = self._clean_code(row['Code2'])
            subclass_name = self._clean_name(row['Title2'])
            parent_class = self._find_parent_class(subclass_code, codings['classes'])
            codings['subclasses'].add((subclass_code, subclass_name, parent_class))
        
        # ุงุณุชุฎุฑุงุฌ ุณุทุญ ุชูุตู
        if pd.notna(row.get('Code3')) and pd.notna(row.get('Title3')):
            detail_code = self._clean_code(row['Code3'])
            detail_name = self._clean_name(row['Title3'])
            parent_subclass = self._find_parent_subclass(detail_code, codings['subclasses'])
            codings['details'].add((detail_code, detail_name, parent_subclass))
    
    def _clean_code(self, code):
        """ูพุงฺฉุณุงุฒ ฺฉุฏ"""
        if isinstance(code, (int, float)):
            return str(int(code))
        return str(code).strip()
    
    def _clean_name(self, name):
        """ูพุงฺฉุณุงุฒ ูุงู"""
        return str(name).strip()
    
    def _find_parent_class(self, subclass_code, classes):
        """ูพุฏุง ฺฉุฑุฏู ูุงูุฏ ฺฉู ุจุฑุง ูุนู"""
        for class_code, class_name in classes:
            if subclass_code.startswith(class_code):
                return class_code
        return None
    
    def _find_parent_subclass(self, detail_code, subclasses):
        """ูพุฏุง ฺฉุฑุฏู ูุงูุฏ ูุนู ุจุฑุง ุชูุตู"""
        for subclass_code, subclass_name, parent_class in subclasses:
            if detail_code.startswith(subclass_code):
                return subclass_code
        return None
```

## ๐ค ุทุฑุงุญ ุงุจุฒุงุฑ LangChain ุจุฑุง ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง

```python
# langchain_tools/coding_tools.py

class CodingExtractorTool(BaseTool):
    name = "coding_extractor"
    description = "ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง ฺฉูุ ูุนู ู ุชูุตู ุงุฒ ูุงู ุงฺฉุณู ูุงู"
    
    def _run(self, file_path: str) -> Dict:
        """ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง ุงุฒ ูุงู ุงฺฉุณู"""
        extractor = IntelligentCodingExtractor()
        df = pd.read_excel(file_path)
        
        # ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง
        extracted_codings = extractor.extract_hierarchical_coding(df)
        
        # ุชุดุฎุต ุณุฑูุตูโูุง ุฌุฏุฏ
        new_codings = self._detect_new_codings(extracted_codings)
        
        return {
            'extracted_codings': extracted_codings,
            'new_codings': new_codings,
            'total_count': self._count_codings(extracted_codings)
        }
    
    def _detect_new_codings(self, extracted_codings):
        """ุชุดุฎุต ุณุฑูุตูโูุง ุฌุฏุฏ"""
        new_codings = {
            'classes': [],
            'subclasses': [],
            'details': []
        }
        
        for level, codings in extracted_codings.items():
            for coding in codings:
                code = coding[0]  # ฺฉุฏ ุงููู ุนูุตุฑ ุงุณุช
                if not self._coding_exists(code, level):
                    new_codings[level].append(coding)
                    
        return new_codings
    
    def _coding_exists(self, code, level):
        """ุจุฑุฑุณ ูุฌูุฏ ฺฉุฏูฺฏ ุฏุฑ ุฏุชุงุจุณ"""
        return CodingStructure.objects.filter(
            code=code, 
            level=level.upper()
        ).exists()

class NewCodingDetectionTool(BaseTool):
    name = "new_coding_detector"
    description = "ุชุดุฎุต ุณุฑูุตูโูุง ุฌุฏุฏ ุฏุฑ ูุงู ุงฺฉุณู ูุงูุงูู"
    
    def _run(self, file_path: str, previous_month_file: str = None) -> Dict:
        """ููุงุณู ุจุง ูุงู ูุงู ูุจู ู ุชุดุฎุต ุณุฑูุตูโูุง ุฌุฏุฏ"""
        current_codings = self._extract_codings(file_path)
        
        if previous_month_file:
            previous_codings = self._extract_codings(previous_month_file)
            new_codings = self._compare_codings(current_codings, previous_codings)
        else:
            # ุงฺฏุฑ ูุงู ูุงู ูุจู ูุจูุฏุ ุจุง ุฏุชุงุจุณ ููุงุณู ฺฉู
            new_codings = self._compare_with_database(current_codings)
            
        return {
            'new_codings': new_codings,
            'change_analysis': self._analyze_changes(new_codings)
        }
```

## ๐ ฺฏุฑุฏุด ฺฉุงุฑ ูพุดููุงุฏ ุจุฑุง ูพุฑุฏุงุฒุด ูุงู ูุงูุงูู

```python
# monthly_processing.py

class MonthlyFileProcessor:
    def process_monthly_file(self, file_path, company_id, month, year):
        """ูพุฑุฏุงุฒุด ฺฉุงูู ูุงู ูุงูุงูู"""
        
        # 1. ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง
        coding_tool = CodingExtractorTool()
        coding_result = coding_tool._run(file_path)
        
        # 2. ุชุดุฎุต ุณุฑูุตูโูุง ุฌุฏุฏ
        detection_tool = NewCodingDetectionTool()
        new_codings = detection_tool._run(file_path)
        
        # 3. ุงุฌุงุฏ ุณุฑูุตูโูุง ุฌุฏุฏ (ุจุง ุชุฃุฏ ฺฉุงุฑุจุฑ)
        created_codings = self._create_new_codings(
            new_codings, 
            company_id, 
            f"{year}-{month:02d}-01"
        )
        
        # 4. ูพุฑุฏุงุฒุด ุงุณูุงุฏ ูุงู
        documents = self._process_financial_documents(
            file_path, 
            company_id, 
            month, 
            year
        )
        
        return {
            'new_codings_created': len(created_codings),
            'documents_processed': len(documents),
            'processing_summary': self._generate_summary()
        }
```

## ๐ ฺฏุฒุงุฑุดโูุง ุชุญูู ูพุดููุงุฏ

```python
# ฺฏุฒุงุฑุดโูุง ุฎุฑูุฌ ุณุณุชู
reports = {
    'coding_changes': 'ฺฏุฒุงุฑุด ุชุบุฑุงุช ุณุงุฎุชุงุฑ ฺฉุฏูฺฏ',
    'new_accounts': 'ฺฏุฒุงุฑุด ุญุณุงุจโูุง ุฌุฏุฏ ุงุฌุงุฏ ุดุฏู', 
    'hierarchy_issues': 'ฺฏุฒุงุฑุด ูุดฺฉูุงุช ุณูุณูู ูุฑุงุชุจ',
    'naming_inconsistencies': 'ฺฏุฒุงุฑุด ูุงุณุงุฒฺฏุงุฑโูุง ูุงูฺฏุฐุงุฑ',
    'monthly_comparison': 'ฺฏุฒุงุฑุด ููุงุณูโุง ูุงูุงูู'
}
```

## ๐ฏ ุงูููุชโุจูุฏ ุงุฌุฑุง

### **ููุชู ฑ: ุงุณุชุฎุฑุงุฌ ูพุงู**
```python
# ุฑูุฒ ฑ-ณ:
201. **ุทุฑุงุญ ุงูฺฏูุฑุชู ุดูุงุณุง ุฎูุฏฺฉุงุฑ ุณุทูุญ ฺฉุฏูฺฏ**
202. **ูพุงุฏูโุณุงุฒ ุณุณุชู ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง ฺฉู**

# ุฑูุฒ ด-ท:  
203. **ุงุฌุงุฏ ุณุณุชู ุงุณุชุฎุฑุงุฌ ุณุฑูุตูโูุง ูุนู ู ุชูุตู**
211. **ุทุฑุงุญ CodingExtractorTool ุจุฑุง LangChain**
```

### **ููุชู ฒ: ุชุดุฎุต ู ฺฉูพุงุฑฺูโุณุงุฒ**
```python
# ุฑูุฒ ธ-ฑฐ:
206. **ูพุงุฏูโุณุงุฒ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ฺฉุฏูฺฏโูุง ุฌุฏุฏ**
214. **ุงุฌุงุฏ NewCodingDetectionTool**

# ุฑูุฒ ฑฑ-ฑด:
207. **ุงุฌุงุฏ ุณุณุชู ูพุดููุงุฏ ูุงู ุจุฑุง ุณุฑูุตูโูุง**
220. **ูพุงุฏูโุณุงุฒ CodingAuditTool**
```

**ุขุง ูุงูุฏ ุจุง ุชุณฺฉ ฒฐฑ (ุทุฑุงุญ ุงูฺฏูุฑุชู ุดูุงุณุง ุฎูุฏฺฉุงุฑ ุณุทูุญ ฺฉุฏูฺฏ) ุดุฑูุน ฺฉููุ** ูโุชูุงูู ฺฉุฏูุง ุงููู ุงุณุชุฎุฑุงุฌ ุงุฒ ูุงู ููููู ุดูุง ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูู.