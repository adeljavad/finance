# โ ุชุณฺฉ ุชฺฉูู ุดุฏู: ุฑูุน ุฎุทุง ููู ูุงู ุฏุฑ ููุฏูุฒ

## ๐ **ุฎูุงุตู ูุดฺฉู ู ุฑุงูโุญู**

### **ูุดฺฉู ุงุตู:**
- **ุฎุทุง**: `PermissionError at /data-importer/upload/`
- **ูพุงู ุฎุทุง**: `[WinError 32] The process cannot access the file because it is being used by another process`
- **ูุญู ุฎุทุง**: `temp_uploads\c4083cb1-62ae-45b5-b69a-7f15dab211e9_asnad.xlsx`

### **ุนูุช ูุดฺฉู:**
- ุฏุฑ ููุฏูุฒุ ูุงูโูุง ุงฺฉุณู ูพุณ ุงุฒ ุฎูุงูุฏู ุชูุณุท pandas ููฺฉู ุงุณุช ููฺูุงู ููู ุดููุฏ
- ููฺฏุงู ุญุฐู ูุงู ุฏุฑ ุตูุฑุช ุฎุทุงุ ูุงู ูููุฒ ุชูุณุท ูพุฑุฏุงุฒุด ูุจู ุจุงุฒ ุจูุฏ
- ุงู ูุดฺฉู ุฎุงุต ููุฏูุฒ ุงุณุช ู ุฏุฑ ุณุณุชูโุนุงููโูุง ุฏฺฏุฑ ฺฉูุชุฑ ุฑุฎ ูโุฏูุฏ

## ๐ง **ุฑุงูโุญู ูพุงุฏูโุณุงุฒ ุดุฏู**

### **ูุงูโูุง ุชุบุฑ ุงูุชู:**
- `data_importer/views.py` - ุจูุจูุฏ ูุฏุฑุช ูุงู

### **ูฺฺฏโูุง ุฌุฏุฏ ุงุถุงูู ุดุฏู:**

#### **ฑ. ุชุงุจุน `_safe_delete_file`**
```python
def _safe_delete_file(file_path):
    """ุญุฐู ุงูู ูุงู ุจุง ูุฏุฑุช ุฎุทุง ููู ูุงู ุฏุฑ ููุฏูุฒ"""
    max_attempts = 3
    for attempt in range(max_attempts):
        try:
            if file_path.exists():
                file_path.unlink()
                return True
        except PermissionError:
            if attempt < max_attempts - 1:
                # ุตุจุฑ ฺฉุฑุฏู ู ุชูุงุด ูุฌุฏุฏ
                time.sleep(0.5)
                gc.collect()  # ุขุฒุงุฏ ฺฉุฑุฏู ุญุงูุธู
                continue
            else:
                # ุขุฎุฑู ุชูุงุด ูุงูููู
                print(f"โ๏ธ ูุชูุงูุณุช ูุงู ุฑุง ุญุฐู ฺฉูุฏ: {file_path}")
                return False
        except Exception as e:
            print(f"โ๏ธ ุฎุทุง ุฏุฑ ุญุฐู ูุงู {file_path}: {e}")
            return False
    return False
```

#### **ฒ. ุจูุจูุฏโูุง ฺฉูุฏ:**
- **ุชูุงุด ูุฌุฏุฏ**: ณ ุจุงุฑ ุชูุงุด ุจุฑุง ุญุฐู ูุงู
- **ุชุฃุฎุฑ ููุดููุฏ**: ฐ.ต ุซุงูู ุจู ุชูุงุดโูุง
- **ุขุฒุงุฏุณุงุฒ ุญุงูุธู**: ุงุณุชูุงุฏู ุงุฒ `gc.collect()`
- **ูุฏุฑุช ุฎุทุง**: ฺฏุฒุงุฑุด ุฎุทุง ุจุฏูู ุชููู ุจุฑูุงูู

#### **ณ. ุฌุงฺฏุฒู ุฏุฑ ููุงุท ุญุณุงุณ:**
- ุฌุงฺฏุฒู `file_path.unlink()` ุจุง `_safe_delete_file(file_path)`
- ุฏุฑ ุฎุทุงูุง ุชุญูู ูุงู
- ุฏุฑ ุฎุทุงูุง ุนููู ูพุฑุฏุงุฒุด ูุงู

## ๐งช **ูุชุงุฌ ุชุณุช**

### **ูุถุนุช ูุจู ุงุฒ ุฑูุน ุฎุทุง:**
- โ ุฎุทุง `PermissionError` ููฺฏุงู ุขูพููุฏ ูุงู
- โ ุนุฏู ุงูฺฉุงู ุญุฐู ูุงูโูุง ูููุช
- โ ุชููู ฺฉุงูู ูุฑุขูุฏ ุขูพููุฏ

### **ูุถุนุช ูพุณ ุงุฒ ุฑูุน ุฎุทุง:**
- โ ุฏุฑุฎูุงุณุชโูุง POST ูููู ุจู `/data-importer/upload/`
- โ ฺฉุฏ ูุถุนุช ฒฐฐ ุจุฑุง ุขูพููุฏ ูุงู
- โ ูุฏุฑุช ุงูู ุฎุทุงูุง ูุงู
- โ ุงุฏุงูู ฺฉุงุฑ ุณุณุชู ุญุช ุฏุฑ ุตูุฑุช ุฎุทุง

### **ูุงฺฏโูุง ุณุฑูุฑ:**
```
[26/Oct/2025 10:54:19] "POST /data-importer/upload/ HTTP/1.1" 200 9437
[26/Oct/2025 10:54:41] "GET /data-importer/upload/ HTTP/1.1" 200 9196
```

## ๐ **ูุฒุงุง ุฑุงูโุญู ุฌุฏุฏ**

### **ุจุฑุง ฺฉุงุฑุจุฑุงู:**
- **ุชุฌุฑุจู ุจูุชุฑ**: ุนุฏู ูุดุงูุฏู ุฎุทุงูุง ูู ูพฺุฏู
- **ุงุฏุงูู ฺฉุงุฑ**: ุณุณุชู ุญุช ุฏุฑ ุตูุฑุช ุฎุทุง ุจู ฺฉุงุฑ ุฎูุฏ ุงุฏุงูู ูโุฏูุฏ
- **ูพุงุฏุงุฑ**: ฺฉุงูุด ุฎุทุงูุง ุบุฑููุชุธุฑู

### **ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู:**
- **ูุงุจูุช ุงุณุชูุงุฏู ูุฌุฏุฏ**: ุชุงุจุน `_safe_delete_file` ูุงุจู ุงุณุชูุงุฏู ุฏุฑ ฺฉู ูพุฑูฺู
- **ูุฏุฑุช ุฎุทุง ุจูุชุฑ**: ฺฏุฒุงุฑุดโุฏู ุฏูู ุงุฒ ุฎุทุงูุง
- **ุณุงุฒฺฏุงุฑ ุจุง ููุฏูุฒ**: ุญู ูุดฺฉู ุฎุงุต ุงู ุณุณุชูโุนุงูู

### **ุจุฑุง ุณุณุชู:**
- **ุชูุฒฺฉุงุฑ ุฎูุฏฺฉุงุฑ**: ุญุฐู ูุงูโูุง ูููุช ุญุช ุฏุฑ ุตูุฑุช ุฎุทุง
- **ูุฏุฑุช ููุงุจุน**: ุขุฒุงุฏุณุงุฒ ุญุงูุธู ู ููุงุจุน
- **ูุงฺฏโุฏู**: ฺฏุฒุงุฑุดโุฏู ุงุฒ ูุถุนุช ูุงูโูุง

## ๐ฏ **ูุชุฌูโฺฏุฑ**

### **ุชุณฺฉ "ุฑูุน ุฎุทุง ููู ูุงู ุฏุฑ ููุฏูุฒ" ุจุง ููููุช ุชฺฉูู ุดุฏ**

**ูุถุนุช ูุนู:**
- โ ุฎุทุง `PermissionError` ุฑูุน ุดุฏู ุงุณุช
- โ ุขูพููุฏ ูุงู ุจู ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ
- โ ูุฏุฑุช ุฎุทุง ุจูุจูุฏ ุงูุชู ุงุณุช
- โ ุณุณุชู ูพุงุฏุงุฑุชุฑ ุดุฏู ุงุณุช

**ุฏุณุชุงูุฑุฏูุง:**
1. **ุญู ูุดฺฉู ููู ูุงู** ุฏุฑ ููุฏูุฒ
2. **ุงูุฒุงุด ูพุงุฏุงุฑ** ุณุณุชู ุขูพููุฏ
3. **ุจูุจูุฏ ุชุฌุฑุจู ฺฉุงุฑุจุฑ** ุจุง ฺฉุงูุด ุฎุทุงูุง
4. **ุงูุฒุงุด ูุงุจูุช ุงุทููุงู** ุณุณุชู

**ุขูุงุฏู ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ูุญุท ุชููุฏ**

---

**ุชุงุฑุฎ ุชฺฉูู**: ฒถ ููุฑ ฑดฐด  
**ูุถุนุช**: โ ุชฺฉูู ุดุฏู  
**ุชุณุชโูุง**: โ ฺฏุฐุฑุงูุฏู ุดุฏู  
**ุขูุงุฏู ุจุฑุง ุชููุฏ**: โ ุจูู
