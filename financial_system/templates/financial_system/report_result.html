{% extends 'financial_system/base.html' %}

{% block title %}{{ report_name }} - {{ company.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-file-earmark-bar-graph text-primary"></i>
        {{ report_name }}
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        {% if company and period %}
        <div class="btn-group me-2">
            <span class="btn btn-outline-secondary">
                <i class="bi bi-building"></i>
                {{ company.name }}
            </span>
            <span class="btn btn-outline-primary">
                <i class="bi bi-calendar"></i>
                {{ period.name }}
            </span>
        </div>
        {% endif %}
        <div class="btn-group">
            <button class="btn btn-outline-success" onclick="window.print()">
                <i class="bi bi-printer"></i>
                ฺุงูพ ฺฏุฒุงุฑุด
            </button>
            <a href="{% url 'financial_system:reports' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i>
                ุจุงุฒฺฏุดุช
            </a>
        </div>
    </div>
</div>

<!-- ุงุทูุงุนุงุช ฺฏุฒุงุฑุด -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <strong>ุดุฑฺฉุช:</strong> {{ company.name }}
                    </div>
                    <div class="col-md-4">
                        <strong>ุฏูุฑู ูุงู:</strong> {{ period.name }}
                    </div>
                    <div class="col-md-4">
                        <strong>ุชุงุฑุฎ ุชููุฏ:</strong> {{ generated_at|date:"Y/m/d H:i" }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ูุญุชูุง ฺฏุฒุงุฑุด -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-file-text"></i>
                    ูุญุชูุง ฺฏุฒุงุฑุด
                </h5>
            </div>
            <div class="card-body">
                {% if report_data %}
                    {% if report_data.type == 'trial_balance' %}
                        <!-- ุชุฑุงุฒ ุขุฒูุงุด -->
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle"></i> ฺฏุฒุงุฑุด ุชุฑุงุฒ ุขุฒูุงุด</h6>
                            <p>ุงู ฺฏุฒุงุฑุด ุฏุฑ ุญุงู ุชูุณุนู ุงุณุช ู ุจู ุฒูุฏ ุงุฒ ุฏุงุฏูโูุง ูุงูุน ูุญุงุณุจู ุฎูุงูุฏ ุดุฏ.</p>
                        </div>
                        
                    {% elif report_data.type == 'balance_sheet' %}
                        <!-- ุชุฑุงุฒูุงูู -->
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle"></i> ฺฏุฒุงุฑุด ุชุฑุงุฒูุงูู</h6>
                            <p>ุงู ฺฏุฒุงุฑุด ุฏุฑ ุญุงู ุชูุณุนู ุงุณุช ู ุจู ุฒูุฏ ุงุฒ ุฏุงุฏูโูุง ูุงูุน ูุญุงุณุจู ุฎูุงูุฏ ุดุฏ.</p>
                        </div>
                        
                    {% elif report_data.type == 'account_turnover' %}
                        <!-- ฺฏุฑุฏุด ุญุณุงุจโูุง -->
                        {% if report_data.data.error %}
                            <div class="alert alert-danger">
                                <h6><i class="bi bi-exclamation-triangle"></i> ุฎุทุง ุฏุฑ ุชููุฏ ฺฏุฒุงุฑุด</h6>
                                <p>{{ report_data.data.error }}</p>
                            </div>
                        {% else %}
                            <!-- ุฌูุนโุจูุฏ ฺฏุฒุงุฑุด -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="bi bi-hash display-4 text-primary"></i>
                                            <h5 class="card-title mt-3">ุชุนุฏุงุฏ ุญุณุงุจโูุง</h5>
                                            <p class="card-text display-6">{{ report_data.data.summary.total_accounts }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="bi bi-arrow-up-circle display-4 text-success"></i>
                                            <h5 class="card-title mt-3">ุฌูุน ุจุฏูฺฉุงุฑ</h5>
                                            <p class="card-text display-6">{{ report_data.data.summary.total_debit|floatformat:0 }} ุฑุงู</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="bi bi-arrow-down-circle display-4 text-danger"></i>
                                            <h5 class="card-title mt-3">ุฌูุน ุจุณุชุงูฺฉุงุฑ</h5>
                                            <p class="card-text display-6">{{ report_data.data.summary.total_credit|floatformat:0 }} ุฑุงู</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="bi bi-scale display-4 {% if report_data.data.summary.is_balanced %}text-success{% else %}text-warning{% endif %}"></i>
                                            <h5 class="card-title mt-3">ูุงูุฏู ฺฉู</h5>
                                            <p class="card-text display-6 {% if report_data.data.summary.is_balanced %}text-success{% else %}text-warning{% endif %}">
                                                {{ report_data.data.summary.total_balance|floatformat:0 }} ุฑุงู
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ุฌุฏูู ุญุณุงุจโูุง -->
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ฺฉุฏ ุญุณุงุจ</th>
                                            <th>ูุงู ุญุณุงุจ</th>
                                            <th>ุชุนุฏุงุฏ ุชุฑุงฺฉูุด</th>
                                            <th>ุฌูุน ุจุฏูฺฉุงุฑ</th>
                                            <th>ุฌูุน ุจุณุชุงูฺฉุงุฑ</th>
                                            <th>ูุงูุฏู</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for account in report_data.data.accounts %}
                                        <tr>
                                            <td><code>{{ account.code }}</code></td>
                                            <td>{{ account.name }}</td>
                                            <td>
                                                <span class="badge bg-secondary">{{ account.transaction_count }}</span>
                                            </td>
                                            <td>
                                                <span class="text-success">{{ account.debit|floatformat:0 }} ุฑุงู</span>
                                            </td>
                                            <td>
                                                <span class="text-danger">{{ account.credit|floatformat:0 }} ุฑุงู</span>
                                            </td>
                                            <td>
                                                <span class="{% if account.balance > 0 %}text-success{% elif account.balance < 0 %}text-danger{% else %}text-muted{% endif %}">
                                                    {{ account.balance|floatformat:0 }} ุฑุงู
                                                </span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <!-- ูุถุนุช ุชุฑุงุฒ -->
                            <div class="alert {% if report_data.data.summary.is_balanced %}alert-success{% else %}alert-warning{% endif %} mt-4">
                                <h6>
                                    <i class="bi {% if report_data.data.summary.is_balanced %}bi-check-circle{% else %}bi-exclamation-triangle{% endif %}"></i>
                                    ูุถุนุช ุชุฑุงุฒ: {% if report_data.data.summary.is_balanced %}โ ูุชุนุงุฏู{% else %}โ๏ธ ูุงูุชุนุงุฏู{% endif %}
                                </h6>
                                <p class="mb-0">
                                    {% if report_data.data.summary.is_balanced %}
                                        ุณุณุชู ูุงู ฺฉุงููุงู ูุชุนุงุฏู ุงุณุช. ุฌูุน ุจุฏูฺฉุงุฑ ู ุจุณุชุงูฺฉุงุฑ ุจุฑุงุจุฑ ุงุณุช.
                                    {% else %}
                                        ุณุณุชู ูุงู ูุงูุชุนุงุฏู ุงุณุช. ุชูุงูุช: {{ report_data.data.summary.total_balance|floatformat:0 }} ุฑุงู
                                    {% endif %}
                                </p>
                            </div>
                        {% endif %}
                        
                    {% elif report_data.type == 'ai_analysis' %}
                        <!-- ุชุญูู ููุดููุฏ -->
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle"></i> ุชุญูู ููุดููุฏ</h6>
                            <p>ุงู ฺฏุฒุงุฑุด ุฏุฑ ุญุงู ุชูุณุนู ุงุณุช ู ุจู ุฒูุฏ ุงุฒ ุฏุงุฏูโูุง ูุงูุน ูุญุงุณุจู ุฎูุงูุฏ ุดุฏ.</p>
                        </div>
                        
                    {% else %}
                        <!-- ฺฏุฒุงุฑุด ุนููู -->
                        <div class="alert alert-warning">
                            <h6><i class="bi bi-exclamation-triangle"></i> ฺฏุฒุงุฑุด ุฏุฑ ุญุงู ุชูุณุนู</h6>
                            <p>ุงู ฺฏุฒุงุฑุด ุฏุฑ ุญุงู ุชูุณุนู ุงุณุช ู ุจู ุฒูุฏ ุงุฒ ุฏุงุฏูโูุง ูุงูุน ูุญุงุณุจู ุฎูุงูุฏ ุดุฏ.</p>
                        </div>
                    {% endif %}
                    
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-file-earmark-x display-1 text-muted"></i>
                        <h4 class="text-muted mt-3">ฺฏุฒุงุฑุด ุชููุฏ ูุดุฏ</h4>
                        <p class="text-muted">ุฎุทุง ุฏุฑ ุชููุฏ ฺฏุฒุงุฑุด ุฑุฎ ุฏุงุฏู ุงุณุช.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ุฑุงูููุง ุงุณุชูุงุฏู -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-light">
                <h6 class="card-title mb-0">
                    <i class="bi bi-info-circle"></i>
                    ุฑุงูููุง ุงุณุชูุงุฏู
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>๐ ุฏุงุฏูโูุง ูุงูุน</h6>
                        <p class="small text-muted">
                            ุงู ฺฏุฒุงุฑุด ุงุฒ ุฏุงุฏูโูุง ูุงูุน ุฏุชุงุจุณ ูุญุงุณุจู ูโุดูุฏ. ุจุฑุง ุฏุฏู ฺฏุฒุงุฑุด ฺฉุงููุ ุงุจุชุฏุง ุฏุงุฏูโูุง ูุงู ุฑุง ุงููพูุฑุช ฺฉูุฏ.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6>๐ ุจูโุฑูุฒุฑุณุงู</h6>
                        <p class="small text-muted">
                            ฺฏุฒุงุฑุดโูุง ุจู ุตูุฑุช ุขู ุชููุฏ ูโุดููุฏ ู ููุดู ุขุฎุฑู ุฏุงุฏูโูุง ุฑุง ููุงุด ูโุฏููุฏ.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ุฏฺฉููโูุง ุนููุงุช -->
<div class="row mt-4">
    <div class="col-12">
        <div class="d-flex justify-content-between">
            <div>
                <a href="{% url 'data_importer:dashboard' %}" class="btn btn-primary">
                    <i class="bi bi-upload"></i>
                    ูุฑูุฏ ุฏุงุฏู ูุงู
                </a>
            </div>
            <div>
                <a href="{% url 'financial_system:reports' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i>
                    ุจุงุฒฺฏุดุช ุจู ูุณุช ฺฏุฒุงุฑุดโูุง
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
