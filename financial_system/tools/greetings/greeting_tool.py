"""
Ø§Ø¨Ø²Ø§Ø± Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù„ÛŒ
"""

from typing import Optional, Dict, Any
from langchain.tools import BaseTool
from pydantic import BaseModel, Field


class GreetingInput(BaseModel):
    """ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø¨Ø²Ø§Ø± Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ"""
    user_name: Optional[str] = Field(
        None, 
        description="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"
    )
    question: str = Field(
        ..., 
        description="Ø³ÙˆØ§Ù„ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ"
    )


class GreetingTool(BaseTool):
    """Ø§Ø¨Ø²Ø§Ø± Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ"""
    
    name: str = "greeting_tool"
    description: str = """
    Ø§Ø¨Ø²Ø§Ø± Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†.
    Ú©Ø§Ø±Ø¨Ø±Ø¯: Ø³Ù„Ø§Ù…ØŒ Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒØŒ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒØŒ Ù…Ø¹Ø±ÙÛŒ Ø®Ø¯Ù…Ø§ØªØŒ Ú†Ù‡ Ú©Ù…Ú©ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø¨Ú©Ù†ÛŒØŸ
    """
    args_schema: type = GreetingInput

    def _run(
        self, 
        question: str, 
        user_name: Optional[str] = None
    ) -> Dict[str, Any]:
        """Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø¨Ø²Ø§Ø± Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ"""
        
        try:
            # ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ø³ÙˆØ§Ù„
            question_lower = question.lower()
            
            # Ø³ÙˆØ§Ù„Ø§Øª Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ
            help_keywords = [
                'Ú©Ù…Ú©', 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ', 'Ø®Ø¯Ù…Ø§Øª', 'Ú†Ù‡ Ú©Ø§Ø±ÛŒ', 'Ú†Ù‡ Ú©Ù…Ú©ÛŒ', 'Ú†Ù‡ Ø®Ø¯Ù…Ø§ØªÛŒ',
                'Ú†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ', 'Ú†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯', 'Ú†Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ', 'Ú†Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯',
                'Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ', 'Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯', 'Ú†Ù‡ Ø®Ø¯Ù…Ø§ØªÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒ',
                'Ú†Ù‡ Ø®Ø¯Ù…Ø§ØªÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯', 'Ú†Ù‡ Ø®Ø¯Ù…Ø§ØªÛŒ Ø¯Ø§Ø±ÛŒ', 'Ú†Ù‡ Ø®Ø¯Ù…Ø§ØªÛŒ Ø¯Ø§Ø±ÛŒØ¯'
            ]
            
            # Ø³ÙˆØ§Ù„Ø§Øª Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ
            greeting_keywords = [
                'Ø³Ù„Ø§Ù…', 'Ø¯Ø±ÙˆØ¯', 'Ø¹Ø±Ø¶ Ø§Ø¯Ø¨', 'ÙˆÙ‚Øª Ø¨Ø®ÛŒØ±', 'Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯', 'Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ'
            ]
            
            is_help_question = any(keyword in question_lower for keyword in help_keywords)
            is_greeting = any(keyword in question_lower for keyword in greeting_keywords)
            
            # ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù…Ù†Ø§Ø³Ø¨
            if is_help_question:
                response = self._generate_help_response(user_name)
            elif is_greeting:
                response = self._generate_greeting_response(user_name)
            else:
                response = self._generate_general_response(user_name, question)
            
            return {
                "success": True,
                "response_type": "greeting",
                "data": response,
                "user_name": user_name,
                "question": question
            }
            
        except Exception as e:
            return {
                "success": False,
                "error": f"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¨Ø²Ø§Ø± Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ: {str(e)}",
                "response_type": "error"
            }

    def _generate_help_response(self, user_name: Optional[str] = None) -> str:
        """ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ"""
        
        greeting = f"Ø³Ù„Ø§Ù… {user_name} Ø¹Ø²ÛŒØ²! ðŸ‘‹" if user_name else "Ø³Ù„Ø§Ù…! ðŸ‘‹"
        
        response = f"""
{greeting}

Ù…Ù† ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù…Ø§Ù„ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÙ… Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ú©Ù†Ù…:

ðŸ“Š **ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡:**
â€¢ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ (Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒØŒ Ø³ÙˆØ¯Ø¢ÙˆØ±ÛŒØŒ Ø§Ù‡Ø±Ù…ÛŒ)
â€¢ ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ú©Ø§Ù…Ù„
â€¢ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø§Ù†Ø­Ø±Ø§ÙØ§Øª Ùˆ Ù…ÙˆØ§Ø±Ø¯ Ù…Ø´Ú©ÙˆÚ©

ðŸ’° **Ù…Ø´Ø§ÙˆØ±Ù‡ Ù…Ø§Ù„ÛŒ Ùˆ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ:**
â€¢ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø§Ù„ÛŒØ§Øª Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù…Ø§Ù„ÛŒ
â€¢ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ
â€¢ Ù…Ø´Ø§ÙˆØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø§Ù„ÛŒ

ðŸ” **Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ Ùˆ Ú©Ù†ØªØ±Ù„:**
â€¢ ØªØ­Ù„ÛŒÙ„ Ø±ÛŒØ³Ú©â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ
â€¢ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ
â€¢ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø·Ø¨Ø§Ù‚ Ø¨Ø§ Ù…Ù‚Ø±Ø±Ø§Øª

ðŸ“ˆ **Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„:**
â€¢ ØªØ±Ø§Ø²Ù†Ø§Ù…Ù‡ Ùˆ ØµÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ
â€¢ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØµÙ„ÛŒ
â€¢ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ù…Ø¹ Ù…Ø§Ù„ÛŒ

**Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ø§Ø² Ø³ÙˆØ§Ù„Ø§ØªÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù¾Ø±Ø³ÛŒØ¯:**
â€¢ "ØªØ±Ø§Ø²Ù†Ø§Ù…Ù‡ Ø´Ø±Ú©Øª Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡"
â€¢ "Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø±Ø§ ØªØ­Ù„ÛŒÙ„ Ú©Ù†"
â€¢ "Ø§Ù†Ø­Ø±Ø§ÙØ§Øª Ù…Ø§Ù„ÛŒ Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ù†"
â€¢ "Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø§Ù…Ø¹ Ù…Ø§Ù„ÛŒ Ø¨Ø¯Ù‡"
â€¢ "Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØµÙ„ ØªØ§Ø¨Ø³ØªØ§Ù† Ø±Ø§ ØªØ­Ù„ÛŒÙ„ Ú©Ù†"

Ú†Ù‡ Ø³ÙˆØ§Ù„ Ù…Ø§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ… Ú©Ù…Ú© Ú©Ù†Ù…! ðŸ˜Š
"""
        return response

    def _generate_greeting_response(self, user_name: Optional[str] = None) -> str:
        """ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ"""
        
        greeting = f"Ø³Ù„Ø§Ù… {user_name} Ø¹Ø²ÛŒØ²! ðŸ˜Š" if user_name else "Ø³Ù„Ø§Ù…! ðŸ˜Š"
        
        response = f"""
{greeting}

Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø§Ù„ÛŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ù…Ù† ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù…Ø§Ù„ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù‡Ø³ØªÙ… Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ù…Ø§Ù„ÛŒ Ùˆ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ú©Ù†Ù….

Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ Ù…Ø§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ ÛŒØ§ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ­Ù„ÛŒÙ„ Ø®Ø§ØµÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ… Ú©Ù…Ú© Ú©Ù†Ù….

Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù¾Ø±Ø³ÛŒØ¯:
â€¢ "Ú†Ù‡ Ú©Ù…Ú©ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø¨Ú©Ù†ÛŒØŸ"
â€¢ "ØªØ±Ø§Ø²Ù†Ø§Ù…Ù‡ Ø´Ø±Ú©Øª Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡"
â€¢ "Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø±Ø§ ØªØ­Ù„ÛŒÙ„ Ú©Ù†"

Ù…Ù†ØªØ¸Ø± Ø³ÙˆØ§Ù„ Ø´Ù…Ø§ Ù‡Ø³ØªÙ…! âœ¨
"""
        return response

    def _generate_general_response(self, user_name: Optional[str] = None, question: str = "") -> str:
        """ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ø¹Ù…ÙˆÙ…ÛŒ"""
        
        greeting = f"Ø³Ù„Ø§Ù… {user_name} Ø¹Ø²ÛŒØ²! ðŸ‘‹" if user_name else "Ø³Ù„Ø§Ù…! ðŸ‘‹"
        
        response = f"""
{greeting}

Ø³ÙˆØ§Ù„ Ø®ÙˆØ¨ÛŒ Ù¾Ø±Ø³ÛŒØ¯ÛŒØ¯! "{question}"

Ù…Ù† ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù…Ø§Ù„ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÙ… Ùˆ ØªØ®ØµØµ Ù…Ù† Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³Øª:

â€¢ ØªØ­Ù„ÛŒÙ„ ØµÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ùˆ Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§
â€¢ ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ùˆ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ  
â€¢ Ù…Ø´Ø§ÙˆØ±Ù‡ Ù…Ø§Ù„ÛŒØ§ØªÛŒ Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù…Ø§Ù„ÛŒ
â€¢ Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ Ùˆ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ
â€¢ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø§Ù†Ø­Ø±Ø§ÙØ§Øª Ù…Ø§Ù„ÛŒ

Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ Ù…Ø§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ… Ú©Ù…Ú© Ú©Ù†Ù…! Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù…Ù† Ø¨Ø®ÙˆØ§Ù‡ÛŒØ¯:

ðŸ“Š "ØªØ±Ø§Ø²Ù†Ø§Ù…Ù‡ ØªÙˆÙ„ÛŒØ¯ Ú©Ù†"
ðŸ’° "Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø±Ø§ ØªØ­Ù„ÛŒÙ„ Ú©Ù†"
ðŸ” "Ø§Ù†Ø­Ø±Ø§ÙØ§Øª Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ù†"
ðŸ“ˆ "Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø§Ù…Ø¹ Ù…Ø§Ù„ÛŒ Ø¨Ø¯Ù‡"

Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù…ØŸ ðŸ˜Š
"""
        return response

    async def _arun(
        self, 
        question: str, 
        user_name: Optional[str] = None
    ) -> Dict[str, Any]:
        """Ø§Ø¬Ø±Ø§ÛŒ Async Ø§Ø¨Ø²Ø§Ø± Ø§Ø­ÙˆØ§Ù„â€ŒÙ¾Ø±Ø³ÛŒ"""
        return self._run(question, user_name)
