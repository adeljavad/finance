# ุชุญูู ุฌุงูุน ุณุณุชู Data Importer

## ๐ ูุถุนุช ูุนู

### 1. ุณุงุฎุชุงุฑ ููุฌูุฏ
- **ExcelStructureAnalyzer**: ุดูุงุณุง ูุญุฏูุฏ ุณุชููโูุง ุงุตู
- **ูุฏูโูุง ูุนู**: `FinancialFile` (metadata), `ImportJob` (ูุฏุฑุช ฺฉุงุฑูุง)
- **ุณุฑูุณ integration**: ูุงุฑุฏ ฺฉุฑุฏู ูุณุชูู ุจู ุฏุชุงุจุณ ุงุตู

### 2. ููุงุท ุถุนู ุดูุงุณุงโุดุฏู
1. ุนุฏู ุดูุงุณุง ุณูุณููโูุฑุงุชุจ ุญุณุงุจโูุง (ฺฉู/ูุนู/ุชูุตู)
2. ุนุฏู ุฐุฎุฑู ุฏุงุฏูโูุง ุฎุงู ูุจู ุงุฒ import
3. ุนุฏู ูพุดุชุจุงู ุงุฒ ฺฉุฏูฺฏโูุง ูุฎุชูู ุดุฑฺฉุชโูุง
4. ุนุฏู ุงูฺฉุงู ูพุฑุฏุงุฒุด ุจุฏูู ุฐุฎุฑู ุฏุชุงุจุณ

---

## ๐ฏ ูุงุฒููุฏโูุง ุฌุฏุฏ

### 1. ุฏู ูุฏู ุงููพูุฑุช
- **ูุฏู A**: ุจุง ุดุฑฺฉุช ู ุฏูุฑู ูุงู (ุฐุฎุฑู ฺฉุงูู)
- **ูุฏู B**: ุนููู ุจุฏูู context (ูพุฑุฏุงุฒุด ูููุช)

### 2. ุณุงุฎุชุงุฑ ุณูุณููโูุฑุงุชุจ ุญุณุงุจโูุง
```
ฺฉุฏ ฺฉู | ูุงู ฺฉู | ฺฉุฏ ูุนู | ูุงู ูุนู | ฺฉุฏ ุชูุตู | ูุงู ุชูุตู
ุดูุงุฑู ุณูุฏ | ุชุงุฑุฎ ุณูุฏ | ุดุฑุญ ุณูุฏ | ูุจูุบ ุจุฏูฺฉุงุฑ | ูุจูุบ ุจุณุชุงูฺฉุงุฑ
```

### 3. ุณุณุชู mapping ฺฉุฏูฺฏ ุงุณุชุงูุฏุงุฑุฏ
- ุชุจุฏู ฺฉุฏูุง ูุฎุชูู ุดุฑฺฉุชโูุง ุจู ฺฉุฏูฺฏ ุงุณุชุงูุฏุงุฑุฏ ูุงุญุฏ
- ูุฏุฑุช mapping ุงุฒ ุทุฑู UI/API

### 4. ุญุงูุช ูพุฑุฏุงุฒุด ุจุฏูู ุฐุฎุฑู
- ุชุญูู ู ูพุฑุฏุงุฒุด ูุงูโูุง ุจุฏูู ุขููุฏู ฺฉุฑุฏู ุฏุชุงุจุณ
- ุงูฺฉุงู ูพุดโููุงุด ูุจู ุงุฒ import ููุง

---

## ๐๏ธ ุทุฑุญ ูู

### ูุฏูโูุง ุฌุฏุฏ

#### 1. RawFinancialData
```python
# ุฐุฎุฑู ุฏุงุฏูโูุง ุฎุงู ุจุง ุณุงุฎุชุงุฑ ุณูุณููโูุฑุงุชุจ
main_account_code, main_account_name
sub_account_code, sub_account_name  
detail_account_code, detail_account_name
document_number, document_date, description
debit_amount, credit_amount
```

#### 2. StandardAccountChart
```python
# ฺุงุฑุช ุญุณุงุจ ุงุณุชุงูุฏุงุฑุฏ ุณุณุชู
standard_code, standard_name, account_type, level, parent
```

#### 3. CompanyAccountMapping
```python
# Mapping ฺฉุฏูุง ุดุฑฺฉุช ุจู ฺฉุฏ ุงุณุชุงูุฏุงุฑุฏ
company_main_code โ standard_main_code
company_sub_code โ standard_sub_code (ุงุฎุชุงุฑ)
company_detail_code โ standard_detail_code (ุงุฎุชุงุฑ)
```

### ุณุฑูุณโูุง ุฌุฏุฏ

#### 1. AccountMappingService
- ุชุจุฏู ุฎูุฏฺฉุงุฑ ฺฉุฏูุง ุดุฑฺฉุช ุจู ุงุณุชุงูุฏุงุฑุฏ
- ูพุดููุงุฏ ููุดููุฏ mapping

#### 2. HierarchicalExcelAnalyzer
- ุดูุงุณุง ุฎูุฏฺฉุงุฑ ุณูุณููโูุฑุงุชุจ ุญุณุงุจโูุง
- ุงูฺฏููุง ูพุดุฑูุชู ุจุฑุง ูุงูโูุง ูุฎุชูู ุณุชููโูุง

#### 3. InMemoryProcessor
- ูพุฑุฏุงุฒุด ูุงูโูุง ุจุฏูู ุฐุฎุฑู ุฏุชุงุจุณ
- ุจุฑฺฏุฑุฏุงูุฏู DataFrame + metadata

### APIูุง ุฌุฏุฏ

#### 1. FlexibleFileUploadView
```
POST /api/files/upload/           # ุชุดุฎุต ุฎูุฏฺฉุงุฑ ูุฏู A/B
```

#### 2. ูุฏุฑุช Mapping
```
GET    /api/standard-accounts/            # ูุณุช ุญุณุงุจโูุง ุงุณุชุงูุฏุงุฑุฏ
POST   /api/company-mappings/             # ุงุฌุงุฏ mapping ุฌุฏุฏ
POST   /api/company-mappings/bulk-import/ # ุขูพููุฏ ูุงู Excel ุจุฑุง bulk mapping
```

#### 3. ูพุฑุฏุงุฒุด ุจุฏูู ุฐุฎุฑู
```
POST   /api/files/analyze-only/           # ุชุญูู ุจุฏูู ุฐุฎุฑู
POST   /api/files/process-temp/          # ูพุฑุฏุงุฒุด ูููุช (ุจุง session)
GET    /api/temp-process/{session_id}/   # ุฏุฑุงูุช ูุชุงุฌ
```

---

## ๐ Flow ูพุฑุฏุงุฒุด ฺฉุงูู

### Flow ูุฏู A (ุจุง ุฐุฎุฑู):
```
1. ุขูพููุฏ ูุงู
2. ุชุญูู ุณุงุฎุชุงุฑ (ExcelStructureAnalyzer)
3. ุฐุฎุฑู ุฏุงุฏูโูุง ุฎุงู (RawFinancialData)
4. ุชุจุฏู ฺฉุฏูฺฏ (AccountMappingService)
5. ุงุนุชุจุงุฑุณูุฌ
6. Import ุจู ุฏุชุงุจุณ ุงุตู
7. ุจูโุฑูุฒุฑุณุงู ูุถุนุช (FinancialFile)
```

### Flow ูุฏู B (ุจุฏูู ุฐุฎุฑู):
```
1. ุขูพููุฏ ูุงู
2. ุชุญูู ุณุงุฎุชุงุฑ
3. ูพุฑุฏุงุฒุด ุฏุฑ ุญุงูุธู (InMemoryProcessor)
4. ุจุฑฺฏุฑุฏุงูุฏู DataFrame + metadata
5. ูพุงฺฉุณุงุฒ ุญุงูุธู (ุงุฎุชุงุฑ)
```

---

## ๐ ูุณุช ุชุณฺฉโูุง ุงุฌุฑุง

### ูุงุฒ 1: ุฒุฑุณุงุฎุช (ููุชู 1)
- [ ] ุงุฌุงุฏ ูุฏูโูุง ุฌุฏุฏ (RawFinancialData, StandardAccountChart, CompanyAccountMapping)
- [ ] ุชูุณุนู AccountMappingService
- [ ] ุจูุจูุฏ ExcelStructureAnalyzer ุจุฑุง ุดูุงุณุง ุณูุณููโูุฑุงุชุจ

### ูุงุฒ 2: APIูุง (ููุชู 2)
- [ ] FlexibleFileUploadView ุจุง ูพุดุชุจุงู ุงุฒ ุฏู ูุฏู
- [ ] APIูุง ูุฏุฑุช mapping
- [ ] APIูุง ูพุฑุฏุงุฒุด ุจุฏูู ุฐุฎุฑู

### ูุงุฒ 3: ฺฉูพุงุฑฺูโุณุงุฒ (ููุชู 3)
- [ ] ฺฉูพุงุฑฺูโุณุงุฒ flow ฺฉุงูู
- [ ] ุชุณุช end-to-end ุจุง ูุงูโูุง ููููู
- [ ] ุงุฌุงุฏ ูุณุชูุฏุงุช ู ูููููโูุง ุงุณุชูุงุฏู

### ูุงุฒ 4: ุจูููโุณุงุฒ (ููุชู 4)
- [ ] ุงุถุงูู ฺฉุฑุฏู caching ุจุฑุง mappingโูุง
- [ ] ุจูุจูุฏ performance ุจุฑุง ูุงูโูุง ุจุฒุฑฺฏ
- [ ] ุงุถุงูู ฺฉุฑุฏู monitoring ู logging

---

## ๐งช ุชุณุชโูุง ููุฑุฏ ูุงุฒ

### ุชุณุชโูุง ูุงุญุฏ
1. ุดูุงุณุง ุณูุณููโูุฑุงุชุจ ุฏุฑ ExcelStructureAnalyzer
2. ุชุจุฏู ฺฉุฏูฺฏ ุฏุฑ AccountMappingService
3. ูพุฑุฏุงุฒุด ุจุฏูู ุฐุฎุฑู ุฏุฑ InMemoryProcessor

### ุชุณุชโูุง ฺฉูพุงุฑฺู
1. Flow ฺฉุงูู ูุฏู A ุจุง ูุงู ููููู
2. Flow ฺฉุงูู ูุฏู B ุจุง ูุงู ููููู
3. Bulk import mapping ุงุฒ Excel

### ุชุณุชโูุง ุนููฺฉุฑุฏ
1. ูพุฑุฏุงุฒุด ูุงูโูุง ุจุฒุฑฺฏ (50MB+)
2. Concurrent uploads
3. Memory usage ุฏุฑ ุญุงูุช ุจุฏูู ุฐุฎุฑู

---

## ๐ง ููุงุญุธุงุช ูู

### 1. ุงููุช
- ุงุนุชุจุงุฑุณูุฌ ูุงูโูุง ุขูพููุฏ ุดุฏู
- ูุญุฏูุฏุช ุญุฌู ูุงู
- Sanitization ุฏุงุฏูโูุง ูุฑูุฏ

### 2. Performance
- ุงุณุชูุงุฏู ุงุฒ pandas ุจุฑุง ูพุฑุฏุงุฒุด ฺฉุงุฑุขูุฏ
- Caching mappingโูุง ุฏุฑ Redis
- ูพุฑุฏุงุฒุด ุบุฑููุฒูุงู ุจุฑุง ูุงูโูุง ุจุฒุฑฺฏ

### 3. ูุงุจูุช ูฺฏูุฏุงุฑ
- Logging ุฌุงูุน
- Error handling ููุงุณุจ
- ูุณุชูุฏุงุช API

### 4. ููุงุณโูพุฐุฑ
- ุทุฑุงุญ stateless ุจุฑุง APIูุง
- ุงูฺฉุงู horizontal scaling
- ุงุณุชูุงุฏู ุงุฒ queue ุจุฑุง ูพุฑุฏุงุฒุดโูุง ุณูฺฏู

---

## ๐ ูุนุงุฑูุง ููููุช

### ูุนุงุฑูุง ูู
- ุฒูุงู ูพุฑุฏุงุฒุด ูุงู 10MB: < 10 ุซุงูู
- ุฏูุช ุดูุงุณุง ุณูุณููโูุฑุงุชุจ: > 90%
- ููููุช ุชุจุฏู ฺฉุฏูฺฏ: > 95%

### ูุนุงุฑูุง ฺฉุงุฑุจุฑ
- ุณูููุช ุงุณุชูุงุฏู ุงุฒ APIูุง
- ฺฉูุช ูุณุชูุฏุงุช
- ุณุฑุนุช ูพุงุณุฎ APIูุง

### ูุนุงุฑูุง ฺฉุณุจโูฺฉุงุฑ
- ฺฉุงูุด ุฒูุงู import ุฏุงุฏูโูุง
- ุงูุฒุงุด ุฏูุช ุฏุงุฏูโูุง ูุงุฑุฏ ุดุฏู
- ฺฉุงูุด ุฎุทุงูุง ุฏุณุช

---

## ๐ ฺฏุงู ุจุนุฏ

ุงู ุชุญูู ุจู ุนููุงู ููุดู ุฑุงู ุจุฑุง ุชูุณุนู ุณุณุชู data_importer ูพุดุฑูุชู ุฎุฏูุช ูโฺฉูุฏ. ูุฑ ูุงุฒ ูโุชูุงูุฏ ุจู ุตูุฑุช ูุณุชูู ูพุงุฏูโุณุงุฒ ู ุชุณุช ุดูุฏ.

**ุชุงุฑุฎ ุงุฌุงุฏ**: ฑดฐด/ฑฐ/ฐณ  
**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู**: ฑดฐด/ฑฐ/ฐณ  
**ูุถุนุช**: ุฏุฑ ุงูุชุธุงุฑ ุชุฃุฏ ููุง
